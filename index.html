<!DOCTYPE html>
<html lang="en" class=""> <!-- Add 'dark' class here to toggle dark mode -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beyond the Curve - Your Scoliosis Companion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
    <script>
        // Tailwind dark mode configuration
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        green: {
                            100: '#f0fdf4',
                            200: '#dcfce7',
                            300: '#bbf7d0',
                            400: '#86efac',
                            500: '#4ade80',
                            600: '#22c55e',
                            700: '#16a34a',
                            800: '#15803d',
                            900: '#166534'
                        },
                        gold: {
                            500: '#eab308',
                            600: '#ca8a04'
                        },
                        yellow: {
                            100: '#fef9c3',
                            200: '#fef08a',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Page transition styles */
        .page {
            display: none;
        }
        .page.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .progress-bar-fill {
            transition: width 0.5s ease-in-out;
        }
        
        .protected-content { display: none; }
        .login-prompt { display: block; }
        .logged-in .protected-content { display: block; }
        .logged-in .login-prompt { display: none; }

        /* Sidebar active link style */
        .sidebar-link.active {
            background-color: #fef9c3; /* yellow-100 */
            color: #166534; /* green-900 */
            font-weight: 600;
        }
        .dark .sidebar-link.active {
            background-color: #166534; /* green-900 */
            color: #fef08a; /* yellow-200 */
        }
        
        /* Bottom nav active link style */
        .bottom-nav-link.active {
            color: #eab308; /* gold-500 */
        }
        .dark .bottom-nav-link.active {
            color: #fef08a; /* yellow-200 */
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200">

    <div id="app" class="max-w-full min-h-screen flex">
        
        <!-- Persistent Sidebar (Desktop) -->
        <nav class="hidden md:flex flex-col w-64 bg-white dark:bg-gray-800 shadow-lg fixed h-full z-10">
            <div class="flex items-center gap-3 p-4 border-b dark:border-gray-700">
                <!-- ICON: Logo -->
                <svg class="w-8 h-8 text-green-700 dark:text-green-500" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2C16.9706 2 21 6.02944 21 11C21 15.9706 16.9706 20 12 20C7.02944 20 3 15.9706 3 11C3 6.02944 7.02944 2 12 2Z" fill="currentColor" fill-opacity="0.2"/>
                    <path d="M15 7C15 7 12 7 12 10C12 13 9 13 9 16C9 19 12 19 12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <h1 class="text-xl font-bold text-green-800 dark:text-green-400">Beyond the Curve</h1>
            </div>
            
            <div class="flex-grow p-4 space-y-2">
                <!-- Nav Links -->
                <button data-page="home" class="nav-link sidebar-link w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg font-semibold hover:bg-gray-100 dark:hover:bg-gray-700">
                    <!-- ICON: Home -->
                    <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    Home
                </button>
                <button data-page="resources" class="nav-link sidebar-link w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg font-semibold hover:bg-gray-100 dark:hover:bg-gray-700">
                    <!-- ICON: Resources -->
                    <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                    </svg>
                    Resources
                </button>
                <button data-page="tracker" class="nav-link sidebar-link w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg font-semibold hover:bg-gray-100 dark:hover:bg-gray-700">
                    <!-- ICON: Brace Tracker -->
                    <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    Brace Tracker
                </button>
                <button data-page="physio" class="nav-link sidebar-link w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg font-semibold hover:bg-gray-100 dark:hover:bg-gray-700">
                    <!-- ICON: Physiotherapy -->
                    <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3 12h3l3 9 4-18 3 9h3"></path>
                    </svg>
                    Physiotherapy
                </button>
                <button data-page="growth" class="nav-link sidebar-link w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg font-semibold hover:bg-gray-100 dark:hover:bg-gray-700">
                    <!-- ICON: Growth Tracker -->
                    <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                        <polyline points="3 17 9 11 13 15 21 7"></polyline>
                        <polyline points="21 17 21 7 11 7"></polyline>
                    </svg>
                    Growth Tracker
                </button>
                <button data-page="journal" class="nav-link sidebar-link w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg font-semibold hover:bg-gray-100 dark:hover:bg-gray-700">
                    <!-- ICON: Journal -->
                    <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                        <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                        <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                    </svg>
                    Journal
                </button>
                <button data-page="screener" class="nav-link sidebar-link w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg font-semibold hover:bg-gray-100 dark:hover:bg-gray-700">
                    <!-- ICON: Screener -->
                    <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2c2.8 0 5 2.2 5 5s-2.2 5-5 5-5-2.2-5-5 2.2-5 5-5z"/>
                        <path d="M20.9 21.5C20.9 17.9 16.9 15 12 15s-8.9 2.9-8.9 6.5"/>
                    </svg>
                    Screener
                </button>
                 <button data-page="community" class="nav-link sidebar-link w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg font-semibold hover:bg-gray-100 dark:hover:bg-gray-700">
                    <!-- ICON: Community -->
                    <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    Community
                </button>
            </div>

            <!-- Streak Counter -->
            <div class="p-4 border-t dark:border-gray-700">
                <div class="bg-gray-100 dark:bg-gray-700 rounded-lg p-3 flex items-center justify-center gap-3">
                    <!-- ICON: Streak -->
                    <svg class="w-8 h-8 text-amber-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2C9.5 5 6.5 7 6.5 11.5c0 3.5 3.5 7.5 5.5 7.5s5.5-4 5.5-7.5C17.5 7 14.5 5 12 2z"></path>
                        <path d="M12 12c0-2-1-3.5-1-3.5C11 8.5 10 9 10 10c0 .5 0 1.5 1 2.5"></path>
                    </svg>
                    <span id="streak-count" class="text-2xl font-bold text-gray-700 dark:text-gray-200">0</span>
                    <span class="font-semibold text-gray-600 dark:text-gray-300">Day Streak</span>
                </div>
            </div>

            <!-- Login/Profile & Dark Mode Toggle -->
            <div class="p-4 border-t dark:border-gray-700 space-y-3">
                <button id="dark-mode-toggle" class="w-full flex items-center justify-center gap-2 bg-gray-200 dark:bg-gray-700 p-2 rounded-lg font-semibold">
                    <!-- ICON: Dark Mode (Moon) -->
                    <svg class="w-6 h-6 dark:hidden" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 22C17.5228 22 22 17.5228 22 12C22 11.5028 21.9613 11.0125 21.8856 10.5319C19.9571 11.8941 17.6143 12.75 15 12.75C9.61522 12.75 5.25 8.38478 5.25 3C5.25 2.00552 5.43085 1.04781 5.76662 0.11438C2.6661 1.9547 0.5 5.25052 0.5 9C0.5 16.1797 6.3203 22 13.5 22C13 22 12.5 22 12 22Z"></path></svg>
                    <!-- ICON: Light Mode (Sun) -->
                    <svg class="w-6 h-6 hidden dark:inline" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 18C15.3137 18 18 15.3137 18 12C18 8.68629 15.3137 6 12 6C8.68629 6 6 8.68629 6 12C6 15.3137 8.68629 18 12 18ZM12 4.5C12.4142 4.5 12.75 4.16421 12.75 3.75V2.25C12.75 1.83579 12.4142 1.5 12 1.5C11.5858 1.5 11.25 1.83579 11.25 2.25V3.75C11.25 4.16421 11.5858 4.5 12 4.5ZM4.92893 6.34315C5.22183 6.63604 5.6967 6.63604 5.98959 6.34315L7.05025 5.28249C7.34315 4.98959 7.34315 4.51472 7.05025 4.22183C6.75736 3.92893 6.28249 3.92893 5.98959 4.22183L4.92893 5.28249C4.63604 5.57538 4.63604 6.05025 4.92893 6.34315ZM19.0711 6.34315C19.364 6.05025 19.364 5.57538 19.0711 5.28249L18.0104 4.22183C17.7175 3.92893 17.2426 3.92893 16.9497 4.22183C16.6569 4.51472 16.6569 4.98959 16.9497 5.28249L18.0104 6.34315C18.3033 6.63604 18.7782 6.63604 19.0711 6.34315ZM22.5 12C22.5 12.4142 22.1642 12.75 21.75 12.75H20.25C19.8358 12.75 19.5 12.4142 19.5 12C19.5 11.5858 19.8358 11.25 20.25 11.25H21.75C22.1642 11.25 22.5 11.5858 22.5 12ZM3.75 11.25C4.16421 11.25 4.5 11.5858 4.5 12C4.5 12.4142 4.16421 12.75 3.75 12.75H2.25C1.83579 12.75 1.5 12.4142 1.5 12C1.5 11.5858 1.83579 11.25 2.25 11.25H3.75ZM18.0104 19.0711C17.7175 19.364 17.2426 19.364 16.9497 19.0711C16.6569 18.7782 16.6569 18.3033 16.9497 18.0104L18.0104 16.9497C18.3033 16.6569 18.7782 16.6569 19.0711 16.9497C19.364 17.2426 19.364 17.7175 19.0711 18.0104L18.0104 19.0711ZM7.05025 19.0711C6.75736 19.364 6.28249 19.364 5.98959 19.0711L4.92893 18.0104C4.63604 17.7175 4.63604 17.2426 4.92893 16.9497C5.22183 16.6569 5.6967 16.6569 5.98959 16.9497L7.05025 18.0104C7.34315 18.3033 7.34315 18.7782 7.05025 19.0711ZM12 19.5C11.5858 19.5 11.25 19.8358 11.25 20.25V21.75C11.25 22.1642 11.5858 22.5 12 22.5C12.4142 22.5 12.75 22.1642 12.75 21.75V20.25C12.75 19.8358 12.4142 19.5 12 19.5Z"></path></svg>
                    Toggle Mode
                </button>

                <div id="auth-container-sidebar">
                    <button id="login-button-sidebar" class="w-full bg-green-700 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-800 transition-colors">
                        Login with Google
                    </button>
                    <div id="user-profile-sidebar" class="hidden items-center gap-2">
                        <img id="user-avatar-sidebar" class="w-10 h-10 rounded-full" src="" alt="User avatar">
                        <div class="flex-grow">
                            <span id="user-name-sidebar" class="font-semibold text-sm">User Name</span>
                            <button id="logout-button-sidebar" class="text-xs text-gray-500 dark:text-gray-400 hover:underline">Logout</button>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content Area -->
        <div class="flex-1 md:ml-64 pb-16 md:pb-0">
            
            <!-- Mobile Header (placeholder for spacing) -->
            <header class="md:hidden bg-green-700 text-white p-4 flex justify-between items-center sticky top-0 z-10">
                <div class="flex items-center gap-3">
                    <!-- ICON: Logo (Mobile) -->
                    <svg class="w-8 h-8" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2C16.9706 2 21 6.02944 21 11C21 15.9706 16.9706 20 12 20C7.02944 20 3 15.9706 3 11C3 6.02944 7.02944 2 12 2Z" fill="white" fill-opacity="0.2"/>
                        <path d="M15 7C15 7 12 7 12 10C12 13 9 13 9 16C9 19 12 19 12 19" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <h1 class="text-xl font-bold">Beyond the Curve</h1>
                </div>
                <div id="auth-container-mobile">
                     <button id="login-button-mobile" class="bg-white text-green-700 font-semibold py-1 px-3 rounded-lg hover:bg-gray-100 text-sm">
                        Login
                    </button>
                    <div id="user-profile-mobile" class="hidden items-center gap-2">
                        <img id="user-avatar-mobile" class="w-8 h-8 rounded-full" src="" alt="User avatar">
                        <button id="logout-button-mobile" class="font-semibold text-sm hover:underline">Logout</button>
                    </div>
                </div>
            </header>
            
            <main class="p-4 md:p-8 flex-grow">
                <!-- Home Page -->
                <div id="home-page" class="page active">
                    <div class="bg-yellow-100 border-l-4 border-gold-500 text-gray-800 dark:bg-gray-800 dark:text-yellow-100 dark:border-gold-500 p-6 rounded-lg shadow-md relative overflow-hidden">
                        <div class="relative z-10">
                            <h2 class="text-3xl font-bold mb-2">Welcome to Your Scoliosis Journey Companion</h2>
                            <p class="text-lg">You're not alone. We're here to empower you with tools, community, and resources to build confidence and resilience. Let's navigate your Scoliosis journey together.</p>
                            <button data-page="infographic" class="nav-link mt-4 inline-flex items-center gap-2 bg-green-600 text-white px-5 py-2 rounded-lg font-semibold hover:bg-green-700 dark:bg-green-700 dark:hover:bg-green-600 transition-colors">
                                <!-- ICON: Infographic/Learn -->
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                                Scoliosis Infographic
                            </button>
                        </div>
                        <svg class="absolute -bottom-10 -right-10 text-green-200 dark:text-green-800 w-48 h-48 opacity-30" fill="currentColor" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                            <path d="M100 5C152.467 5 195 47.5329 195 100C195 152.467 152.467 195 100 195C47.5329 195 5 152.467 5 100C5 47.5329 47.5329 5 100 5Z" stroke="currentColor" stroke-width="10" stroke-linecap="round" stroke-linejoin="round" transform="rotate(30 100 100)"/>
                        </svg>
                    </div>

                    <div class="mt-8 grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div data-page="tracker" class="nav-link bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-green-200 dark:hover:shadow-green-900 transition-shadow flex flex-col cursor-pointer">
                            <div class="flex items-center gap-4">
                                <div class="bg-green-100 dark:bg-green-900 p-3 rounded-full">
                                    <!-- ICON: Brace Tracker Card -->
                                    <svg class="w-8 h-8 text-green-600 dark:text-green-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <polyline points="12 6 12 12 16 14"></polyline>
                                    </svg>
                                </div>
                                <h3 class="text-xl font-bold text-green-700 dark:text-green-400">Daily Brace Tracker</h3>
                            </div>
                            <p class="mt-4 flex-grow">Log your brace hours, watch your progress, and earn rewards.</p>
                        </div>
                        <div data-page="physio" class="nav-link bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-green-200 dark:hover:shadow-green-900 transition-shadow flex flex-col cursor-pointer">
                            <div class="flex items-center gap-4">
                                <div class="bg-green-100 dark:bg-green-900 p-3 rounded-full">
                                    <!-- ICON: Physiotherapy Card -->
                                    <svg class="w-8 h-8 text-green-600 dark:text-green-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M3 12h3l3 9 4-18 3 9h3"></path>
                                    </svg>
                                </div>
                                <h3 class="text-xl font-bold text-green-700 dark:text-green-400">Physiotherapy Tracker</h3>
                            </div>
                            <p class="mt-4 flex-grow">Track your daily PT sessions and stay consistent with your exercises.</p>
                        </div>
                        <div data-page="growth" class="nav-link bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-green-200 dark:hover:shadow-green-900 transition-shadow flex flex-col cursor-pointer">
                            <div class="flex items-center gap-4">
                                <div class="bg-green-100 dark:bg-green-900 p-3 rounded-full">
                                    <!-- ICON: Growth Tracker Card -->
                                    <svg class="w-8 h-8 text-green-600 dark:text-green-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                                        <polyline points="3 17 9 11 13 15 21 7"></polyline>
                                        <polyline points="21 17 21 7 11 7"></polyline>
                                    </svg>
                                </div>
                                <h3 class="text-xl font-bold text-green-700 dark:text-green-400">Growth Tracker</h3>
                            </div>
                            <p class="mt-4 flex-grow">Log your height and weight to visualize growth trends over time.</p>
                        </div>
                        <div data-page="journal" class="nav-link bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-green-200 dark:hover:shadow-green-900 transition-shadow flex flex-col cursor-pointer">
                            <div class="flex items-center gap-4">
                                <div class="bg-green-100 dark:bg-green-900 p-3 rounded-full">
                                    <!-- ICON: Journal Card -->
                                    <svg class="w-8 h-8 text-green-600 dark:text-green-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                                        <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                                    </svg>
                                </div>
                                <h3 class="text-xl font-bold text-green-700 dark:text-green-400">Reflection Journal</h3>
                            </div>
                            <p class="mt-4 flex-grow">A private space to write, with data saved securely to your Google Drive.</p>
                        </div>
                        <div data-page="screener" class="nav-link bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-green-200 dark:hover:shadow-green-900 transition-shadow flex flex-col cursor-pointer">
                            <div class="flex items-center gap-4">
                                <div class="bg-green-100 dark:bg-green-900 p-3 rounded-full">
                                    <!-- ICON: Screener Card -->
                                    <svg class="w-8 h-8 text-green-600 dark:text-green-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M12 2c2.8 0 5 2.2 5 5s-2.2 5-5 5-5-2.2-5-5 2.2-5 5-5z"/>
                                        <path d="M20.9 21.5C20.9 17.9 16.9 15 12 15s-8.9 2.9-8.9 6.5"/>
                                    </svg>
                                </div>
                                <h3 class="text-xl font-bold text-green-700 dark:text-green-400">Scoliosis Screener</h3>
                            </div>
                            <p class="mt-4 flex-grow">Use this guided tool to check for asymmetry. (Not a diagnosis)</p>
                        </div>
                        <div data-page="resources" class="nav-link bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-green-200 dark:hover:shadow-green-900 transition-shadow flex flex-col cursor-pointer">
                            <div class="flex items-center gap-4">
                                <div class="bg-green-100 dark:bg-green-900 p-3 rounded-full">
                                    <!-- ICON: Resources Card -->
                                    <svg class="w-8 h-8 text-green-600 dark:text-green-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                                        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                                    </svg>
                                </div>
                                <h3 class="text-xl font-bold text-green-700 dark:text-green-400">Vetted Resources</h3>
                            </div>
                            <p class="mt-4 flex-grow">Find surgeons, apparel, support groups, and helpful videos all in one place.</p>

                        </div>
                         <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 transition-shadow flex flex-col opacity-70 cursor-not-allowed">
                            <div class="flex items-center gap-4">
                                <div class="bg-green-100 dark:bg-green-900 p-3 rounded-full">
                                    <!-- ICON: Community Card -->
                                    <svg class="w-8 h-8 text-green-600 dark:text-green-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                        <circle cx="9" cy="7" r="4"></circle>
                                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                    </svg>
                                </div>
                                <h3 class="text-xl font-bold text-green-700 dark:text-green-400">Community Hub</h3>
                            </div>
                            <p class="mt-4 flex-grow">Connect with peers in our safe, moderated forums. (Coming Soon)</p>
                        </div>
                    </div>
                </div>

                <!-- Vetted Resources Page -->
                <div id="resources-page" class="page">
                    <div class="flex items-center justify-center gap-3 mb-6">
                        <!-- ICON: Resources Header -->
                        <svg class="w-10 h-10 text-green-600 dark:text-green-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                        </svg>
                        <h2 class="text-3xl font-bold">Vetted Resources</h2>
                    </div>
                    <div class="space-y-8">
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                            <h3 class="text-2xl font-bold mb-4 text-green-800 dark:text-green-300">Scoliosis Specialists</h3>
                            <p class="mb-4 text-gray-600 dark:text-gray-300">
                                For the most comprehensive directory, we recommend the official Scoliosis Research Society (SRS) physician locator.
                            </p>
                            <a href="https://www.srs.org/Patients/Find-a-Specialist#" target="_blank" rel="noopener noreferrer" class="inline-block bg-green-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-green-700 transition-colors">
                                Visit SRS Find a Specialist &rarr;
                            </a>
                        </div>
                        
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                            <h3 class="text-2xl font-bold mb-4 text-green-800 dark:text-green-300">Video Library</h3>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <h4 class="text-lg font-semibold mb-2">Scoliosis Introduction</h4>
                                    <ul class="space-y-2 list-disc list-inside text-green-700 dark:text-green-400">
                                        <li><a href="https://www.youtube.com/watch?v=JicoSIe2JQI" target="_blank" rel="noopener noreferrer" class="hover:underline">Spine Anatomy in under 1 minute</a></li>
                                        <li><a href="https://www.youtube.com/watch?v=Vqy1VB2CuaE" target="_blank" rel="noopener noreferrer" class="hover:underline">What is Scoliosis (In under 1 Minute)</a></li>
                                        <li><a href="https://www.youtube.com/watch?v=4blk8rrfJPw" target="_blank" rel="noopener noreferrer" class="hover:underline">How to Detect Scoliosis</a></li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 class="text-lg font-semibold mb-2">Physiotherapy</h4>
                                    <ul class="space-y-2 list-disc list-inside text-green-700 dark:text-green-400">
                                        <li><a href="https://youtube.com/playlist?list=PLfyUArn76Mvi1yqoyEvJIEkMNf7OTG5eB&si=7hHnIFJ6klQnSDvN" target="_blank" rel="noopener noreferrer" class="hover:underline">Physiotherapy Videos for Scoliosis Playlist</a></li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 class="text-lg font-semibold mb-2">Treatment Options</h4>
                                    <ul class="space-y-2 list-disc list-inside text-green-700 dark:text-green-400">
                                        <li><a href="https://www.youtube.com/watch?v=_nLXf5jEn5k&t=101s" target="_blank" rel="noopener noreferrer" class="hover:underline">About Bracing</a></li>
                                        <li><a href="https://www.youtube.com/watch?v=JCDEc2uYwxA&t=18s" target="_blank" rel="noopener noreferrer" class="hover:underline">About Scoliosis Surgery</a></li>
                                        <li><a href="https://www.youtube.com/watch?v=OX1vhVSzMiI" target="_blank" rel="noopener noreferrer" class="hover:underline">Spinal Fusion v/s VBT</a></li>
                                        <li><a href="https://www.youtube.com/watch?v=G1ynUYSqLsU" target="_blank" rel="noopener noreferrer" class="hover:underline">Hybrid Fusion</a></li>
                                    </ul>
                                </div>
                                <div>
                                    <h4 class="text-lg font-semibold mb-2">Surgery Experience</h4>
                                    <ul class="space-y-2 list-disc list-inside text-green-700 dark:text-green-400">
                                        <li><a href="https://www.youtube.com/watch?v=3gKel6MwW98&t=12s" target="_blank" rel="noopener noreferrer" class="hover:underline">What to Expect Before and After Surgery</a></li>
                                        <li><a href="https://www.youtube.com/watch?v=L8kHuCjqXyo" target="_blank" rel="noopener noreferrer" class="hover:underline">Hospital Stay Checklist</a></li>
                                        <li><a href="https://www.youtube.com/watch?v=YHKTELBwreo&t=21s" target="_blank" rel="noopener noreferrer" class="hover:underline">Life Post-Surgery</a></li>
                                    </ul>
                                </div>
                                 <div>
                                    <h4 class="text-lg font-semibold mb-2">Surgeon Interviews</h4>
                                    <ul class="space-y-2 list-disc list-inside text-green-700 dark:text-green-400">
                                        <li><a href="https://youtube.com/playlist?list=PLfyUArn76MviC3wiB67PdATXA3EJGfQlc&si=ZSU0NonH0itejvzV" target="_blank" rel="noopener noreferrer" class="hover:underline">Vertebral Body Tethering (VBT)</a></li>
                                        <li><a href="https://youtu.be/WID1p_UJZIM?si=S-c6FJ525PfS6GU2" target="_blank" rel="noopener noreferrer" class="hover:underline">Spinal Fusion Details</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                                <h3 class="text-xl font-bold mb-4 text-green-800 dark:text-green-300">Major Organizations</h3>
                                <ul class="space-y-3 list-disc list-inside text-green-700 dark:text-green-400">
                                    <li><a href="https://www.srs.org/" target="_blank" rel="noopener noreferrer" class="hover:underline">Scoliosis Research Society (SRS)</a></li>
                                    <li><a href="https://www.scoliosis.org/" target="_blank" rel="noopener noreferrer" class="hover:underline">National Scoliosis Foundation (NSF)</a></li>
                                    <li><a href="https://www.settingscoliosisstraight.org/" target="_blank" rel="noopener noreferrer" class="hover:underline">Setting Scoliosis Straight</a></li>
                                    <li><a href="http://www.sosort.mobi/" target="_blank" rel="noopener noreferrer" class="hover:underline">SOSORT</a></li>
                                </ul>
                            </div>
                             <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                                <h3 class="text-xl font-bold mb-4 text-green-800 dark:text-green-300">Medical Institutions</h3>
                                <ul class="space-y-3 list-disc list-inside text-green-700 dark:text-green-400">
                                    <li><a href="https://www.mayoclinic.org/diseases-conditions/scoliosis/symptoms-causes/syc-20350716" target="_blank" rel="noopener noreferrer" class="hover:underline">Mayo Clinic</a></li>
                                    <li><a href="https://www.hopkinsmedicine.org/health/conditions-and-diseases/scoliosis" target="_blank" rel="noopener noreferrer" class="hover:underline">Johns Hopkins Medicine</a></li>
                                    <li><a href="https://www.childrenshospital.org/conditions/scoliosis" target="_blank" rel="noopener noreferrer" class="hover:underline">Boston Children's Hospital</a></li>
                                    <li><a href="https://www.hss.edu/condition-list_scoliosis.asp" target="_blank" rel="noopener noreferrer" class="hover:underline">Hospital for Special Surgery (HSS)</a></li>
                                    <li><a href="https://www.shrinerschildrens.org/en/conditions/scoliosis" target="_blank" rel="noopener noreferrer" class="hover:underline">Shriners Hospitals for Children</a></li>
                                </ul>
                            </div>
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                                <h3 class="text-xl font-bold mb-4 text-green-800 dark:text-green-300">Brace-Friendly Apparel</h3>
                                <ul class="space-y-3 list-disc list-inside text-green-700 dark:text-green-400">
                                    <li><a href="https://www.hopescloset.co/" target="_blank" rel="noopener noreferrer" class="hover:underline">Hope's Closet</a></li>
                                    <li><a href="https://www.brace-tee.com/" target="_blank" rel="noopener noreferrer" class="hover:underline">Brace-Tee</a></li>
                                    <li><a href="https://embracedincomfort.com/" target="_blank" rel="noopener noreferrer" class="hover:underline">Embraced in Comfort</a></li>
                                </ul>
                            </div>
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                                <h3 class="text-xl font-bold mb-4 text-green-800 dark:text-green-300">Support Groups & Forums</h3>
                                <ul class="space-y-3 list-disc list-inside text-green-700 dark:text-green-400">
                                    <li><a href="https://www.curvygirlsscoliosis.com/" target="_blank" rel="noopener noreferrer" class="hover:underline">Curvy Girls International</a></li>
                                    <li><a href="https://www.scoliboys.com/" target="_blank" rel="noopener noreferrer" class="hover:underline">ScoliBoys Support</a></li>
                                    <li><a href="https://scolios-us.org/" target="_blank" rel="noopener noreferrer" class="hover:underline">Scolio-US</a></li>
                                    <li><a href="https://www.higgybears.com/" target="_blank" rel="noopener noreferrer" class="hover:underline">Higgy Bears</a></li>
                                    <li><a href="https://www.facebook.com/groups/ScoliosisParents/" target="_blank" rel="noopener noreferrer" class="hover:underline">Facebook Support Group</a></li>
                                </ul>
                            </div>
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                                <h3 class="text-xl font-bold mb-4 text-green-800 dark:text-green-300">Financial/Practical Aid</h3>
                                <ul class="space-y-3 list-disc list-inside text-green-700 dark:text-green-400">
                                    <li><a href="https://www.childrensscoliosisfoundation.org/" target="_blank" rel="noopener noreferrer" class="hover:underline">Children's Scoliosis Foundation</a></li>
                                    <li><a href="https://www.uhccf.org/" target="_blank" rel="noopener noreferrer" class="hover:underline">UnitedHealthcare Children's Foundation</a></li>
                                    <li><a href="https://www.mercymedicalangels.org/" target="_blank" rel="noopener noreferrer" class="hover:underline">Mercy Medical Angels</a></li>
                                </ul>
                            </div>
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                                <h3 class="text-xl font-bold mb-4 text-green-800 dark:text-green-300">General Education</h3>
                                <ul class="space-y-3 list-disc list-inside text-green-700 dark:text-green-400">
                                    <li><a href="https://medlineplus.gov/scoliosis.html" target="_blank" rel="noopener noreferrer" class="hover:underline">MedlinePlus</a></li>
                                    <li><a href="https://orthoinfo.aaos.org/en/diseases--conditions/scoliosis-in-children-and-adolescents/" target="_blank" rel="noopener noreferrer" class="hover:underline">AAOS</a></li>
                                    <li><a href="https://kidshealth.org/en/parents/scoliosis.html" target="_blank" rel="noopener noreferrer" class="hover:underline">KidsHealth</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Brace Tracker Page -->
                <div id="tracker-page" class="page">
                    <div class="login-prompt text-center p-8 bg-gray-100 dark:bg-gray-800 rounded-lg">
                        <h3 class="text-2xl font-bold mb-4">Login to Track Your Progress</h3>
                        <p class="mb-6">Please log in with your Google account to use the Brace Tracker. Your data will be stored safely in your own Google Drive.</p>
                        <button id="login-button-tracker" class="bg-green-700 text-white font-semibold py-2 px-6 rounded-lg hover:bg-green-800 transition-colors">Login with Google</button>
                    </div>
                    <div class="protected-content">
                        <div class="flex items-center justify-center gap-3 mb-6">
                            <!-- ICON: Brace Tracker Header -->
                            <svg class="w-10 h-10 text-green-600 dark:text-green-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            <h2 class="text-3xl font-bold text-center">My Brace Tracker</h2>
                        </div>
                        <div class="grid md:grid-cols-2 gap-8">
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                                <h3 class="text-xl font-bold mb-4">Log Today's Hours</h3>
                                <form id="brace-form" class="space-y-4">
                                    <div>
                                        <label for="brace-date" class="block font-semibold">Date</label>
                                        <input type="date" id="brace-date" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg mt-1 bg-gray-50 dark:bg-gray-700" required>
                                    </div>
                                    <div>
                                        <label for="brace-hours" class="block font-semibold">Hours Worn</label>
                                        <input type="number" id="brace-hours" min="0" max="24" step="0.5" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg mt-1 bg-gray-50 dark:bg-gray-700" placeholder="e.g., 18.5" required>
                                    </div>
                                    <div>
                                        <label for="daily-goal" class="block font-semibold">Daily Goal (hours)</label>
                                        <input type="number" id="daily-goal" min="1" max="24" step="1" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg mt-1 bg-gray-50 dark:bg-gray-700" value="18">
                                    </div>
                                    <button type="submit" class="w-full bg-green-700 text-white py-2 rounded-lg font-semibold hover:bg-green-800 dark:hover:bg-green-600 transition-colors">Log Hours</button>
                                </form>
                            </div>
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                                <h3 class="text-xl font-bold mb-4">Today's Progress</h3>
                                <div>
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-8">
                                        <div id="progress-bar" class="progress-bar-fill bg-green-600 h-8 text-white text-center font-bold leading-8 rounded-full" style="width: 0%;">0%</div>
                                    </div>
                                    <p id="progress-text" class="text-center mt-2 font-semibold">Log your hours to see your progress!</p>
                                </div>
                                <div class="mt-6">
                                    <h3 class="text-xl font-bold mb-4">My Rewards</h3>
                                    <div id="rewards-container" class="flex flex-wrap gap-4">
                                        <p class="text-gray-500 dark:text-gray-400">Start logging to earn badges!</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-8 bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                            <h3 class="text-xl font-bold mb-4">Weekly Progress</h3>
                            <canvas id="brace-chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Physiotherapy Tracker Page -->
                <div id="physio-page" class="page">
                    <div class="login-prompt text-center p-8 bg-gray-100 dark:bg-gray-800 rounded-lg">
                        <h3 class="text-2xl font-bold mb-4">Login to Track Your Physiotherapy</h3>
                        <p class="mb-6">Please log in with your Google account to use the PT Tracker. Your data will be stored safely in your own Google Drive.</p>
                        <button id="login-button-physio" class="bg-green-700 text-white font-semibold py-2 px-6 rounded-lg hover:bg-green-800 transition-colors">Login with Google</button>
                    </div>
                    <div class="protected-content">
                        <div class="flex items-center justify-center gap-3 mb-6">
                            <!-- ICON: Physiotherapy Header -->
                            <svg class="w-10 h-10 text-green-600 dark:text-green-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                                <path d="M3 12h3l3 9 4-18 3 9h3"></path>
                            </svg>
                            <h2 class="text-3xl font-bold text-center">My Physiotherapy Tracker</h2>
                        </div>
                        <div class="grid md:grid-cols-2 gap-8">
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                                <h3 class="text-xl font-bold mb-4">Log Today's Session</h3>
                                <form id="physio-form" class="space-y-4">
                                    <div>
                                        <label for="physio-date" class="block font-semibold">Date</label>
                                        <input type="date" id="physio-date" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg mt-1 bg-gray-50 dark:bg-gray-700" required>
                                    </div>
                                    <div>
                                        <label for="physio-minutes" class="block font-semibold">Minutes of PT</label>
                                        <input type="number" id="physio-minutes" min="0" max="240" step="1" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg mt-1 bg-gray-50 dark:bg-gray-700" placeholder="e.g., 45" required>
                                    </div>
                                    <div>
                                        <label for="physio-daily-goal" class="block font-semibold">Daily Goal (minutes)</label>
                                        <input type="number" id="physio-daily-goal" min="1" max="240" step="1" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg mt-1 bg-gray-50 dark:bg-gray-700" value="30">
                                    </div>
                                    <button type="submit" class="w-full bg-green-700 text-white py-2 rounded-lg font-semibold hover:bg-green-800 dark:hover:bg-green-600 transition-colors">Log Session</button>
                                </form>
                            </div>
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                                <h3 class="text-xl font-bold mb-4">Today's Progress</h3>
                                <div>
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-8">
                                        <div id="physio-progress-bar" class="progress-bar-fill bg-green-600 h-8 text-white text-center font-bold leading-8 rounded-full" style="width: 0%;">0%</div>
                                    </div>
                                    <p id="physio-progress-text" class="text-center mt-2 font-semibold">Log your session to see your progress!</p>
                                </div>
                                <div class="mt-6">
                                    <h3 class="text-xl font-bold mb-4">My PT Rewards</h3>
                                    <div id="physio-rewards-container" class="flex flex-wrap gap-4">
                                        <p class="text-gray-500 dark:text-gray-400">Start logging to earn badges!</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-8 bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                            <h3 class="text-xl font-bold mb-4">Weekly PT Progress</h3>
                            <canvas id="physio-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Growth Tracker Page -->
                <div id="growth-page" class="page">
                    <div class="login-prompt text-center p-8 bg-gray-100 dark:bg-gray-800 rounded-lg">
                        <h3 class="text-2xl font-bold mb-4">Login to Track Your Growth</h3>
                        <p class="mb-6">Please log in with your Google account to use the Growth Tracker. Your data will be stored safely in your own Google Drive.</p>
                        <button id="login-button-growth" class="bg-green-700 text-white font-semibold py-2 px-6 rounded-lg hover:bg-green-800 transition-colors">Login with Google</button>
                    </div>
                    <div class="protected-content">
                        <div class="flex items-center justify-center gap-3 mb-6">
                            <!-- ICON: Growth Tracker Header -->
                            <svg class="w-10 h-10 text-green-600 dark:text-green-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                                <polyline points="3 17 9 11 13 15 21 7"></polyline>
                                <polyline points="21 17 21 7 11 7"></polyline>
                            </svg>
                            <h2 class="text-3xl font-bold text-center">My Growth Tracker</h2>
                        </div>
                        <div class="grid md:grid-cols-2 gap-8">
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                                <h3 class="text-xl font-bold mb-4">Log New Measurement</h3>
                                <form id="growth-form" class="space-y-4">
                                    <div>
                                        <label for="growth-date" class="block font-semibold">Date</label>
                                        <input type="date" id="growth-date" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg mt-1 bg-gray-50 dark:bg-gray-700" required>
                                    </div>
                                    <div>
                                        <label for="growth-height" class="block font-semibold">Height (cm)</label>
                                        <input type="number" id="growth-height" min="0" step="0.1" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg mt-1 bg-gray-50 dark:bg-gray-700" placeholder="e.g., 150.5" required>
                                    </div>
                                    <div>
                                        <label for="growth-weight" class="block font-semibold">Weight (kg)</label>
                                        <input type="number" id="growth-weight" min="0" step="0.1" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg mt-1 bg-gray-50 dark:bg-gray-700" placeholder="e.g., 45.2">
                                    </div>
                                    <button type="submit" class="w-full bg-green-700 text-white py-2 rounded-lg font-semibold hover:bg-green-800 dark:hover:bg-green-600 transition-colors">Log Measurement</button>
                                </form>
                            </div>
                             <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                                <svg class="w-full h-32 text-green-200 dark:text-green-700" fill="currentColor" viewBox="0 0 100 100" preserveAspectRatio="none">
                                    <path d="M0 100 C 20 80, 40 80, 50 90 S 80 100, 100 80 L 100 100 Z"></path>
                                    <path d="M0 100 C 15 70, 35 70, 50 80 S 80 90, 100 70 L 100 100 Z" opacity="0.5"></path>
                                </svg>
                                <h3 class="text-xl font-bold mb-2 -mt-8 text-center relative z-10">Growth Trends</h3>
                                <p class="text-center relative z-10">Log your measurements to see your growth curve projected here.</p>
                            </div>
                        </div>
                        <div class="mt-8 bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                            <h3 class="text-xl font-bold mb-4">Growth Chart</h3>
                            <canvas id="growth-chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Journal Page -->
                <div id="journal-page" class="page">
                    <div class="login-prompt text-center p-8 bg-gray-100 dark:bg-gray-800 rounded-lg">
                        <h3 class="text-2xl font-bold mb-4">Login to Use Your Journal</h3>
                        <p class="mb-6">Please log in with your Google account to use the Reflection Journal. Your entries will be stored safely and privately in your own Google Drive.</p>
                        <button id="login-button-journal" class="bg-green-700 text-white font-semibold py-2 px-6 rounded-lg hover:bg-green-800 transition-colors">Login with Google</button>
                    </div>
                    <div class="protected-content">
                        <div class="flex items-center justify-center gap-3 mb-6">
                            <!-- ICON: Journal Header -->
                            <svg class="w-10 h-10 text-green-600 dark:text-green-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                                <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                                <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                            </svg>
                            <h2 class="text-3xl font-bold">My Reflection Journal</h2>
                        </div>
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                            <form id="journal-form">
                                <h3 class="text-xl font-bold mb-2">New Entry</h3>
                                <p class="text-gray-600 dark:text-gray-300 mb-4">How are you feeling today? This is your private space.</p>
                                <textarea id="journal-entry" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700" rows="8" placeholder="Write about your day, your thoughts, or anything on your mind..."></textarea>
                                <div class="flex justify-end mt-4">
                                    <button type="submit" class="w-full bg-green-700 text-white py-2 px-6 rounded-lg font-semibold hover:bg-green-800 dark:hover:bg-green-600 transition-colors">Save Entry</button>
                                </div>
                            </form>
                        </div>
                        <div class="mt-8">
                            <h3 class="text-2xl font-bold mb-4">Past Entries</h3>
                            <div id="journal-entries-container" class="space-y-6">
                                <p class="text-gray-500 dark:text-gray-400">Your saved entries will appear here.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Screener Page -->
                <div id="screener-page" class="page flex flex-col">
                    <div class="flex items-center justify-center gap-3 mb-6">
                        <!-- ICON: Screener Header -->
                        <svg class="w-10 h-10 text-green-600 dark:text-green-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2c2.8 0 5 2.2 5 5s-2.2 5-5 5-5-2.2-5-5 2.2-5 5-5z"/>
                            <path d="M20.9 21.5C20.9 17.9 16.9 15 12 15s-8.9 2.9-8.9 6.5"/>
                        </svg>
                        <h2 class="text-3xl font-bold">Scoliosis Screener</h2>
                    </div>
                    
                    <div class="bg-yellow-100 border-l-4 border-gold-500 text-yellow-800 dark:bg-gray-800 dark:text-yellow-100 dark:border-gold-500 p-4 rounded-lg shadow-md mb-6">
                        <h3 class="font-bold text-lg">Medical Disclaimer</h3>
                        <p class="mt-1">This tool is for informational purposes only and is **not a substitute for a medical diagnosis**. Please consult a qualified healthcare professional for any health concerns.</p>
                    </div>

                    <iframe class="flex-grow w-full h-full min-h-[70vh] border-0 rounded-lg shadow-lg" src="https://leiamehta.github.io/beyondthecurve/scolioscreen.html"></iframe>
                </div>

                <!-- Community Hub Page (Placeholder) -->
                <div id="community-page" class="page">
                    <div class="flex items-center justify-center gap-3 mb-6">
                        <!-- ICON: Community Header -->
                        <svg class="w-10 h-10 text-green-600 dark:text-green-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                        <h2 class="text-3xl font-bold">Community Hub</h2>
                    </div>
                    <div class="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 text-center">
                        <h3 class="text-2xl font-bold text-gold-500 dark:text-gold-400 mb-4">Coming Soon!</h3>
                        <p class="text-lg text-gray-600 dark:text-gray-300">
                            A safe, moderated forum for kids and parents to share experiences is on its way.
                        </p>
                        <p class="mt-2 text-gray-600 dark:text-gray-300">We're building separate, age-appropriate spaces for you to connect with peers who understand your journey.</p>
                    </div>
                </div>

                <!-- NEW INFOGRAPHIC PAGE -->
                <div id="infographic-page" class="page flex flex-col">
                    <div class="flex items-center justify-center gap-3 mb-6">
                        <!-- ICON: Infographic/Learn -->
                        <svg class="w-10 h-10 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg>
                        <h2 class="text-3xl font-bold">Scoliosis Infographic</h2>
                    </div>
                    <div class="bg-white dark:bg-gray-800 p-2 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 flex-grow">
                        <iframe class="w-full h-full min-h-[75vh] border-0 rounded-lg" src="https://leiamehta.github.io/beyondthecurve/scoliosis_infographic.html"></iframe>
                    </div>
                </div>

            </main>
        </div>

        <!-- Bottom Navigation (Mobile) -->
        <nav class="md:hidden fixed bottom-0 left-0 right-0 h-16 bg-white dark:bg-gray-800 shadow-inner z-10 flex justify-around items-center border-t dark:border-gray-700">
            <button data-page="home" class="nav-link bottom-nav-link flex flex-col items-center justify-center text-gray-600 dark:text-gray-300">
                <!-- ICON: Home (Bottom Nav) -->
                <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V9z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                <span class="text-xs font-semibold">Home</span>
            </button>
            <button data-page="resources" class="nav-link bottom-nav-link flex flex-col items-center justify-center text-gray-600 dark:text-gray-300">
                 <!-- ICON: Resources (Bottom Nav) -->
                 <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                    <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                    <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                </svg>
                <span class="text-xs font-semibold">Resources</span>
            </button>
            <button data-page="tracker" class="nav-link bottom-nav-link flex flex-col items-center justify-center text-gray-600 dark:text-gray-300">
                <!-- ICON: Brace Tracker (Bottom Nav) -->
                <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                </svg>
                <span class="text-xs font-semibold">Brace</span>
            </button>
            <button data-page="physio" class="nav-link bottom-nav-link flex flex-col items-center justify-center text-gray-600 dark:text-gray-300">
                 <!-- ICON: Physiotherapy (Bottom Nav) -->
                 <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                    <path d="M3 12h3l3 9 4-18 3 9h3"></path>
                </svg>
                <span class="text-xs font-semibold">Physio</span>
            </button>
            <button data-page="journal" class="nav-link bottom-nav-link flex flex-col items-center justify-center text-gray-600 dark:text-gray-300">
                <!-- ICON: Journal (Bottom Nav) -->
                <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
                    <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path>
                    <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
                </svg>
                <span class="text-xs font-semibold">Journal</span>
            </button>
        </nav>
    </div>

    <script>
        const app = {
            // STATE
            googleGisReady: false,
            tokenClient: null,
            accessToken: null,
            fileId: null,
            isLoggedIn: false,
            userInfo: null,
            
            // App Data Object
            data: {
                braceData: {},
                physioData: {},
                growthData: {},
                journalData: [],
                gamification: {
                    streak: 0,
                    lastLogDate: null
                }
            },
            
            // UI ELEMENTS
            pages: null, navLinks: null,
            loginButtons: [],
            logoutButtons: [],
            userProfiles: [],
            userAvatars: [],
            appContainer: null,
            streakCount: null,
            darkModeToggle: null,

            // Brace Tracker
            braceForm: null, braceDate: null, braceHours: null, dailyGoal: null,
            progressBar: null, progressText: null, rewardsContainer: null, braceChart: null,
            
            // Physio Tracker
            physioForm: null, physioDate: null, physioMinutes: null, physioDailyGoal: null,
            physioProgressBar: null, physioProgressText: null, physioRewardsContainer: null, physioChart: null,
            
            // Growth Tracker
            growthForm: null, growthDate: null, growthHeight: null, growthWeight: null, growthChart: null,

            // Journal
            journalForm: null, journalEntry: null, journalEntriesContainer: null,
            
            // --- INITIALIZATION ---
            async init() {
                if (this.googleGisReady) {
                    await this.setupApp();
                }
            },

            async setupApp() {
                // Query selectors
                this.appContainer = document.getElementById('app');
                this.pages = document.querySelectorAll('.page');
                this.navLinks = document.querySelectorAll('.nav-link');
                
                // Auth Elements
                this.loginButtons = [
                    document.getElementById('login-button-sidebar'),
                    document.getElementById('login-button-mobile'),
                    document.getElementById('login-button-tracker'),
                    document.getElementById('login-button-physio'),
                    document.getElementById('login-button-growth'),
                    document.getElementById('login-button-journal'),
                ];
                this.logoutButtons = [
                    document.getElementById('logout-button-sidebar'),
                    document.getElementById('logout-button-mobile'),
                ];
                this.userProfiles = [
                    document.getElementById('user-profile-sidebar'),
                    document.getElementById('user-profile-mobile'),
                ];
                this.userAvatars = [
                    document.getElementById('user-avatar-sidebar'),
                    document.getElementById('user-avatar-mobile'),
                ];

                // Gamification
                this.streakCount = document.getElementById('streak-count');
                this.darkModeToggle = document.getElementById('dark-mode-toggle');

                // Brace Tracker
                this.braceForm = document.getElementById('brace-form');
                this.braceDate = document.getElementById('brace-date');
                this.braceHours = document.getElementById('brace-hours');
                this.dailyGoal = document.getElementById('daily-goal');
                this.progressBar = document.getElementById('progress-bar');
                this.progressText = document.getElementById('progress-text');
                this.rewardsContainer = document.getElementById('rewards-container');
                
                // Physio Tracker
                this.physioForm = document.getElementById('physio-form');
                this.physioDate = document.getElementById('physio-date');
                this.physioMinutes = document.getElementById('physio-minutes');
                this.physioDailyGoal = document.getElementById('physio-daily-goal');
                this.physioProgressBar = document.getElementById('physio-progress-bar');
                this.physioProgressText = document.getElementById('physio-progress-text');
                this.physioRewardsContainer = document.getElementById('physio-rewards-container');
                
                // Growth Tracker
                this.growthForm = document.getElementById('growth-form');
                this.growthDate = document.getElementById('growth-date');
                this.growthHeight = document.getElementById('growth-height');
                this.growthWeight = document.getElementById('growth-weight');

                // Journal
                this.journalForm = document.getElementById('journal-form');
                this.journalEntry = document.getElementById('journal-entry');
                this.journalEntriesContainer = document.getElementById('journal-entries-container');

                // Event Listeners
                this.setupEventListeners();

                // Initial UI State
                this.initDarkMode();
                const lastPage = localStorage.getItem('lastPage') || 'home';
                this.navigateTo(lastPage);
                
                this.braceDate.valueAsDate = new Date();
                this.physioDate.valueAsDate = new Date();
                this.growthDate.valueAsDate = new Date();
                
                this.handleVisitorCounter();

                // Initialize Google Auth Client
                const GOOGLE_CLIENT_ID = "704532323173-lks375tr64fg63iok7bm1sn0slao6nge.apps.googleusercontent.com";
                const SCOPES = 'https://www.googleapis.com/auth/drive.appdata https://www.googleapis.com/auth/userinfo.profile';
                
                this.tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: GOOGLE_CLIENT_ID,
                    scope: SCOPES,
                    callback: async (tokenResponse) => {
                        if (tokenResponse && tokenResponse.access_token) {
                            this.accessToken = tokenResponse.access_token;
                            this.isLoggedIn = true;
                            await this.onLoginSuccess();
                        } else if (tokenResponse.error) {
                             console.log(`GSI Error: ${tokenResponse.error}`);
                            this.isLoggedIn = false;
                            this.updateUiForAuthState();
                        }
                    },
                });

                this.tokenClient.requestAccessToken({ prompt: 'none' });
            },
            
            async onLoginSuccess() {
                await this.fetchUserInfo();
                await this.findOrCreateDataFile(); // This will load data
                this.updateUiForAuthState();
            },

            setupEventListeners() {
                this.navLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        this.navigateTo(e.currentTarget.dataset.page);
                    });
                });
                
                this.loginButtons.forEach(btn => btn?.addEventListener('click', () => this.handleAuthClick()));
                this.logoutButtons.forEach(btn => btn?.addEventListener('click', () => this.handleSignoutClick()));
                
                this.darkModeToggle?.addEventListener('click', () => this.toggleDarkMode());

                // Form Submissions
                this.braceForm?.addEventListener('submit', (e) => this.handleBraceSubmit(e));
                this.physioForm?.addEventListener('submit', (e) => this.handlePhysioSubmit(e));
                this.growthForm?.addEventListener('submit', (e) => this.handleGrowthSubmit(e));
                this.journalForm?.addEventListener('submit', (e) => this.handleJournalSubmit(e));
            },

            handleVisitorCounter() {
                let count = localStorage.getItem('visitorCount') || 0;
                count++;
                localStorage.setItem('visitorCount', count);
                // No counter element in the new design
            },
            
            // --- Dark Mode ---
            initDarkMode() {
                if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            },
            toggleDarkMode() {
                if (document.documentElement.classList.contains('dark')) {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('theme', 'light');
                } else {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('theme', 'dark');
                }
            },

            // --- UI State ---
            updateUiForAuthState() {
                if (this.isLoggedIn && this.userInfo) {
                    this.appContainer.classList.add('logged-in');
                    document.getElementById('login-button-sidebar').classList.add('hidden');
                    document.getElementById('login-button-mobile').classList.add('hidden');
                    document.getElementById('user-profile-sidebar').classList.remove('hidden');
                    document.getElementById('user-profile-sidebar').classList.add('flex');
                    document.getElementById('user-profile-mobile').classList.remove('hidden');
                    document.getElementById('user-profile-mobile').classList.add('flex');
                    document.getElementById('user-avatar-sidebar').src = this.userInfo.picture;
                    document.getElementById('user-avatar-mobile').src = this.userInfo.picture;
                    document.getElementById('user-name-sidebar').textContent = this.userInfo.name;
                } else {
                    this.appContainer.classList.remove('logged-in');
                    document.getElementById('login-button-sidebar').classList.remove('hidden');
                    document.getElementById('login-button-mobile').classList.remove('hidden');
                    document.getElementById('user-profile-sidebar').classList.add('hidden');
                    document.getElementById('user-profile-mobile').classList.add('hidden');
                    this.fileId = null;
                    this.data = { braceData: {}, physioData: {}, growthData: {}, journalData: [], gamification: { streak: 0, lastLogDate: null } };
                    this.loadAllData();
                }
            },

            navigateTo(pageId) {
                if (!pageId) pageId = 'home';
                
                this.pages.forEach(page => page.classList.remove('active'));
                const targetPage = document.getElementById(`${pageId}-page`);
                if (targetPage) {
                    targetPage.classList.add('active');
                }
                
                localStorage.setItem('lastPage', pageId);

                // Update active state for nav links
                document.querySelectorAll('.sidebar-link, .bottom-nav-link').forEach(link => {
                    link.classList.remove('active');
                    if (link.dataset.page === pageId) {
                        link.classList.add('active');
                    }
                });
            },

            // --- Google Auth & Drive Methods ---
            handleAuthClick() {
                this.tokenClient.requestAccessToken({ prompt: 'consent' });
            },
            handleSignoutClick() {
                if (this.accessToken) {
                    google.accounts.oauth2.revoke(this.accessToken, () => {
                        this.accessToken = null;
                        this.isLoggedIn = false;
                        this.updateUiForAuthState();
                    });
                }
            },
            async fetchUserInfo() {
                if (!this.accessToken) return;
                try {
                    const response = await fetch('https://www.googleapis.com/oauth2/v3/userinfo', {
                        headers: { 'Authorization': `Bearer ${this.accessToken}` }
                    });
                    if (!response.ok) throw new Error('Failed to fetch user info');
                    const userInfo = await response.json();
                    this.userInfo = { name: userInfo.name, picture: userInfo.picture };
                } catch (error) {
                    console.error("Error fetching user info:", error);
                    this.userInfo = null;
                }
            },
            async findOrCreateDataFile() {
                if (!this.accessToken) return;
                try {
                    const response = await fetch("https://www.googleapis.com/drive/v3/files?q=name='beyond-the-curve-data.json'&spaces=appDataFolder&fields=files(id,name)", {
                        headers: { 'Authorization': `Bearer ${this.accessToken}` }
                    });
                    const data = await response.json();

                    if (data.files && data.files.length > 0) {
                        this.fileId = data.files[0].id;
                        await this.loadDataFromDrive();
                    } else {
                        const fileMetadata = {
                            'name': 'beyond-the-curve-data.json',
                             'parents': ['appDataFolder']
                        };
                         const createResponse = await fetch("https://www.googleapis.com/drive/v3/files", {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${this.accessToken}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(fileMetadata)
                        });
                        const newFile = await createResponse.json();
                        this.fileId = newFile.id;
                        await this.saveDataToDrive(); 
                    }
                } catch (err) {
                    console.error("Error finding or creating file", err);
                }
            },
            async loadDataFromDrive() {
                if (!this.fileId || !this.accessToken) return;
                try {
                    const response = await fetch(`https://www.googleapis.com/drive/v3/files/${this.fileId}?alt=media`, {
                         headers: { 'Authorization': `Bearer ${this.accessToken}` }
                    });
                    if (response.status === 200) {
                        const text = await response.text();
                         if (text) {
                            const loadedData = JSON.parse(text);
                            // Merge loaded data with defaults to prevent errors
                            this.data = {
                                braceData: loadedData.braceData || {},
                                physioData: loadedData.physioData || {},
                                growthData: loadedData.growthData || {},
                                journalData: loadedData.journalData || [],
                                gamification: loadedData.gamification || { streak: 0, lastLogDate: null }
                            };
                        } else {
                           throw new Error("Empty response from Drive");
                        }
                    }
                } catch (e) {
                    console.log("Could not parse JSON from Drive, file may be new.", e);
                } finally {
                    this.loadAllData();
                }
            },
            async saveDataToDrive() {
                if (!this.fileId || !this.accessToken) return;
                try {
                    await fetch(`https://www.googleapis.com/upload/drive/v3/files/${this.fileId}?uploadType=media`, {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `Bearer ${this.accessToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(this.data) // Save the entire data object
                    });
                } catch (err) {
                    console.error("Error saving data to drive", err);
                }
            },
            
            // Load all data into UI
            loadAllData() {
                this.loadBraceData();
                this.loadPhysioData();
                this.loadGrowthData();
                this.loadJournalData();
                this.updateStreak();
            },

            // --- Gamification ---
            updateStreak() {
                const today = new Date().toISOString().split('T')[0];
                const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
                
                const lastLog = this.data.gamification.lastLogDate;
                
                if (lastLog && lastLog !== today && lastLog !== yesterday) {
                    this.data.gamification.streak = 0; // Reset streak
                }
                
                this.streakCount.textContent = this.data.gamification.streak;
            },
            
            async logActivity() {
                const today = new Date().toISOString().split('T')[0];
                const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
                const lastLog = this.data.gamification.lastLogDate;

                if (lastLog !== today) {
                    if (lastLog === yesterday) {
                        this.data.gamification.streak++;
                    } else {
                        this.data.gamification.streak = 1;
                    }
                    this.data.gamification.lastLogDate = today;
                    this.streakCount.textContent = this.data.gamification.streak;
                    await this.saveDataToDrive();
                }
            },

            // --- Brace Tracker Methods ---
            async handleBraceSubmit(e) { e.preventDefault(); const date = this.braceDate.value; const hours = parseFloat(this.braceHours.value); const goal = parseFloat(this.dailyGoal.value); if (!date || isNaN(hours) || isNaN(goal)) { return; } this.data.braceData[date] = { hours, goal }; await this.logActivity(); await this.saveDataToDrive(); this.updateProgressUI(date); this.updateChart(); this.updateRewards(); this.braceForm.reset(); this.braceDate.valueAsDate = new Date(); },
            loadBraceData() { const today = new Date().toISOString().split('T')[0]; this.updateProgressUI(today); this.updateChart(); this.updateRewards(); },
            updateProgressUI(date) { const data = this.data.braceData[date]; if (data) { const percentage = Math.min(100, Math.round((data.hours / data.goal) * 100)); this.progressBar.style.width = `${percentage}%`; this.progressBar.textContent = `${percentage}%`; this.progressText.textContent = `You've logged ${data.hours} of ${data.goal} hours today. Keep it up!`; } else { this.progressBar.style.width = '0%'; this.progressBar.textContent = '0%'; this.progressText.textContent = 'Log your hours to see your progress!'; } },
            updateChart() { const ctx = document.getElementById('brace-chart').getContext('2d'); const labels = []; const hoursData = []; const goalData = []; for (let i = 6; i >= 0; i--) { const d = new Date(); d.setDate(d.getDate() - i); const dateString = d.toISOString().split('T')[0]; labels.push(d.toLocaleDateString('en-US', { weekday: 'short' })); const data = this.data.braceData[dateString]; hoursData.push(data ? data.hours : 0); goalData.push(data ? data.goal : parseFloat(this.dailyGoal.value)); } if (this.braceChart) { this.braceChart.destroy(); } this.braceChart = new Chart(ctx, { type: 'bar', data: { labels: labels, datasets: [{ label: 'Hours Worn', data: hoursData, backgroundColor: 'rgba(22, 163, 74, 0.6)' }, { label: 'Goal', data: goalData, type: 'line', fill: false, borderColor: 'rgba(239, 68, 68, 1)' }] }, options: { scales: { y: { beginAtZero: true, title: { display: true, text: 'Hours' } } } } }); },
            updateRewards() { const totalDaysLogged = Object.keys(this.data.braceData).length; const rewards = [ { name: 'First Step', threshold: 1, icon: '🌟', description: 'Logged your first day!' }, { name: 'Consistent Week', threshold: 7, icon: '📅', description: 'Logged 7 days in a row!' }, { name: '30-Day Warrior', threshold: 30, icon: '🛡️', description: 'Logged for 30 days!' }]; this.rewardsContainer.innerHTML = ''; let earnedCount = 0; rewards.forEach(reward => { const isEarned = totalDaysLogged >= reward.threshold; if(isEarned) earnedCount++; const rewardEl = document.createElement('div'); rewardEl.className = `text-center p-2 rounded-lg ${isEarned ? 'bg-yellow-100 dark:bg-gray-700' : 'bg-gray-100 dark:bg-gray-900'}`; rewardEl.innerHTML = `<div class="text-4xl ${isEarned ? '' : 'opacity-30'}">${reward.icon}</div><div class="font-semibold text-sm ${isEarned ? 'text-gold-600 dark:text-gold-400' : 'text-gray-500'}">${reward.name}</div><div class="text-xs text-gray-500 dark:text-gray-400">${reward.description}</div>`; this.rewardsContainer.appendChild(rewardEl); }); if(earnedCount === 0){ this.rewardsContainer.innerHTML = '<p class="text-gray-500 dark:text-gray-400">Start logging to earn badges!</p>'; } },
            
            // --- Physiotherapy Tracker Methods ---
            async handlePhysioSubmit(e) { e.preventDefault(); const date = this.physioDate.value; const minutes = parseFloat(this.physioMinutes.value); const goal = parseFloat(this.physioDailyGoal.value); if (!date || isNaN(minutes) || isNaN(goal)) { return; } this.data.physioData[date] = { minutes, goal }; await this.logActivity(); await this.saveDataToDrive(); this.updatePhysioProgressUI(date); this.updatePhysioChart(); this.updatePhysioRewards(); this.physioForm.reset(); this.physioDate.valueAsDate = new Date(); },
            loadPhysioData() { const today = new Date().toISOString().split('T')[0]; this.updatePhysioProgressUI(today); this.updatePhysioChart(); this.updatePhysioRewards(); },
            updatePhysioProgressUI(date) { const data = this.data.physioData[date]; if (data) { const percentage = Math.min(100, Math.round((data.minutes / data.goal) * 100)); this.physioProgressBar.style.width = `${percentage}%`; this.physioProgressBar.textContent = `${percentage}%`; this.physioProgressText.textContent = `You've logged ${data.minutes} of ${data.goal} minutes today. Great job!`; } else { this.physioProgressBar.style.width = '0%'; this.physioProgressBar.textContent = '0%'; this.physioProgressText.textContent = 'Log your session to see your progress!'; } },
            updatePhysioChart() { const ctx = document.getElementById('physio-chart').getContext('2d'); const labels = []; const minutesData = []; const goalData = []; for (let i = 6; i >= 0; i--) { const d = new Date(); d.setDate(d.getDate() - i); const dateString = d.toISOString().split('T')[0]; labels.push(d.toLocaleDateString('en-US', { weekday: 'short' })); const data = this.data.physioData[dateString]; minutesData.push(data ? data.minutes : 0); goalData.push(data ? data.goal : parseFloat(this.physioDailyGoal.value)); } if (this.physioChart) { this.physioChart.destroy(); } this.physioChart = new Chart(ctx, { type: 'bar', data: { labels: labels, datasets: [{ label: 'Minutes of PT', data: minutesData, backgroundColor: 'rgba(22, 163, 74, 0.6)' }, { label: 'Goal', data: goalData, type: 'line', fill: false, borderColor: 'rgba(239, 68, 68, 1)' }] }, options: { scales: { y: { beginAtZero: true, title: { display: true, text: 'Minutes' } } } } }); },
            updatePhysioRewards() { const totalDaysLogged = Object.keys(this.data.physioData).length; const rewards = [ { name: 'First Session', threshold: 1, icon: '💪', description: 'Logged your first PT session!' }, { name: 'PT Week', threshold: 7, icon: '🗓️', description: 'Logged PT 7 days in a row!' }, { name: 'Month of Motion', threshold: 30, icon: '🤸', description: 'Logged PT for 30 days!'} ]; this.physioRewardsContainer.innerHTML = ''; let earnedCount = 0; rewards.forEach(reward => { const isEarned = totalDaysLogged >= reward.threshold; if(isEarned) earnedCount++; const rewardEl = document.createElement('div'); rewardEl.className = `text-center p-2 rounded-lg ${isEarned ? 'bg-yellow-100 dark:bg-gray-700' : 'bg-gray-100 dark:bg-gray-900'}`; rewardEl.innerHTML = `<div class="text-4xl ${isEarned ? '' : 'opacity-30'}">${reward.icon}</div><div class="font-semibold text-sm ${isEarned ? 'text-gold-600 dark:text-gold-400' : 'text-gray-500'}">${reward.name}</div><div class="text-xs text-gray-500 dark:text-gray-400">${reward.description}</div>`; this.rewardsContainer.appendChild(rewardEl); }); if(earnedCount === 0){ this.rewardsContainer.innerHTML = '<p class="text-gray-500 dark:text-gray-400">Start logging to earn badges!</p>'; } },
            
            // --- Growth Tracker Methods ---
            async handleGrowthSubmit(e) { e.preventDefault(); const date = this.growthDate.value; const height = parseFloat(this.growthHeight.value); const weight = parseFloat(this.growthWeight.value); if (!date || (isNaN(height) && isNaN(weight))) { return; } this.data.growthData[date] = { height: isNaN(height) ? null : height, weight: isNaN(weight) ? null : weight }; await this.saveDataToDrive(); this.updateGrowthChart(); this.growthForm.reset(); this.growthDate.valueAsDate = new Date(); },
            loadGrowthData() { this.updateGrowthChart(); },
            updateGrowthChart() { const ctx = document.getElementById('growth-chart').getContext('2d'); const sortedDates = Object.keys(this.data.growthData).sort((a, b) => new Date(a) - new Date(b)); const labels = sortedDates.map(date => new Date(date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })); const heightData = sortedDates.map(date => this.data.growthData[date].height); const weightData = sortedDates.map(date => this.data.growthData[date].weight); if (this.growthChart) { this.growthChart.destroy(); } this.growthChart = new Chart(ctx, { type: 'line', data: { labels: labels, datasets: [ { label: 'Height (cm)', data: heightData, borderColor: 'rgba(22, 163, 74, 1)', backgroundColor: 'rgba(22, 163, 74, 0.1)', fill: true, yAxisID: 'yHeight', spanGaps: true, }, { label: 'Weight (kg)', data: weightData, borderColor: 'rgba(234, 179, 8, 1)', backgroundColor: 'rgba(234, 179, 8, 0.1)', fill: true, yAxisID: 'yWeight', spanGaps: true, } ] }, options: { scales: { yHeight: { type: 'linear', display: true, position: 'left', title: { display: true, text: 'Height (cm)' } }, yWeight: { type: 'linear', display: true, position: 'right', title: { display: true, text: 'Weight (kg)' }, grid: { drawOnChartArea: false, } } } } }); },


            // --- Screener Methods ---
            async handleScreenerSubmit(e) {
                e.preventDefault();
                // This function is no longer needed for data saving
            },
            loadScreenerData() {
                // No data to load for iframe
            },
            
            // --- Journal Methods ---
            async handleJournalSubmit(e) { e.preventDefault(); const text = this.journalEntry.value.trim(); if (text === '') return; const newEntry = { id: Date.now(), date: new Date().toISOString(), text: text }; this.data.journalData.unshift(newEntry); await this.saveDataToDrive(); this.renderJournalEntries(); this.journalForm.reset(); },
            loadJournalData() { this.renderJournalEntries(); },
            renderJournalEntries() {
                this.journalEntriesContainer.innerHTML = '';
                if(this.data.journalData.length === 0) {
                    this.journalEntriesContainer.innerHTML = '<p class="text-gray-500 dark:text-gray-400">Your saved entries will appear here.</p>';
                    return;
                }
                this.data.journalData.forEach(entry => {
                    const entryEl = document.createElement('div');
                    entryEl.className = 'bg-white dark:bg-gray-800 p-4 rounded-lg shadow border border-gray-200 dark:border-gray-700';
                    const entryDate = new Date(entry.date);
                    entryEl.innerHTML = `
                        <div class="flex justify-between items-center mb-2">
                            <p class="font-semibold text-gray-700 dark:text-gray-300">${entryDate.toLocaleDateString()} - ${entryDate.toLocaleTimeString()}</p>
                            <button data-id="${entry.id}" class="delete-entry-btn text-red-500 hover:text-red-700 font-bold text-xl px-2">&times;</button>
                        </div>
                        <p class="text-gray-800 dark:text-gray-200 whitespace-pre-wrap">${entry.text}</p>
                    `;
                    this.journalEntriesContainer.appendChild(entryEl);
                });

                document.querySelectorAll('.delete-entry-btn').forEach(btn => btn.addEventListener('click', (e) => this.deleteJournalEntry(e)));
            },
            async deleteJournalEntry(e) { const entryId = parseInt(e.target.dataset.id, 10); this.data.journalData = this.data.journalData.filter(entry => entry.id !== entryId); await this.saveDataToDrive(); this.renderJournalEntries(); },
        };

        function gisLoaded() {
            app.googleGisReady = true;
            app.init();
        }
    </script>
</body>
</html>


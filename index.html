<!DOCTYPE html>
<html lang="en" class=""> <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beyond the Curve - Your Scoliosis Companion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
    <script>
        // Tailwind dark mode configuration
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        green: {
                            100: '#f0fdf4',
                            200: '#dcfce7',
                            300: '#bbf7d0',
                            400: '#86efac',
                            500: '#4ade80',
                            600: '#22c55e',
                            700: '#16a34a', // Primary Dark Green
                            800: '#15803d',
                            900: '#166534'
                        },
                        gold: {
                            500: '#eab308', // Accent Gold
                            600: '#ca8a04'
                        },
                        yellow: {
                            100: '#fef9c3',
                            200: '#fef08a',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Page transition styles */
        .page {
            display: none;
        }
        .page.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .progress-bar-fill {
            transition: width 0.5s ease-in-out;
        }
        
        .protected-content { display: none; }
        .login-prompt { display: block; }
        .logged-in .protected-content { display: block; }
        .logged-in .login-prompt { display: none; }

        /* Sidebar active link style */
        .sidebar-link.active {
            background-color: #fef9c3; /* yellow-100 */
            color: #166534; /* green-900 */
            font-weight: 600;
        }
        .dark .sidebar-link.active {
            background-color: #166534; /* green-900 */
            color: #fef08a; /* yellow-200 */
        }
        
        /* Bottom nav active link style */
        .bottom-nav-link.active {
            color: #eab308; /* gold-500 */
        }
        .dark .bottom-nav-link.active {
            color: #fef08a; /* yellow-200 */
        }

        /* --- New Style for Tabs on Resources Page --- */
        .resource-tab-button.active {
            border-bottom-width: 3px;
            border-color: #eab308; /* gold-500 */
            color: #16a34a; /* green-700 */
            font-weight: 600;
        }
        .dark .resource-tab-button.active {
            border-color: #fef08a; /* yellow-200 */
            color: #fef08a; /* yellow-200 */
        }
        .resource-tab-panel {
            display: none;
        }
        .resource-tab-panel.active {
            display: block;
        }
        
        /* --- New CSS for Circular Progress Meter --- */
        .progress-circle {
            position: relative;
            width: 100%;
            padding-top: 100%; /* Creates a square container */
        }
        .progress-circle svg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: rotate(-90deg); /* Start the circle at the top */
        }
        .progress-circle .circle-bg, .progress-circle .circle-progress {
            fill: none;
            stroke-width: 8; /* Thickness of the ring */
        }
        .progress-circle .circle-progress {
            transition: stroke-dasharray 0.5s linear;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200">

    <div id="app" class="max-w-full min-h-screen flex">
        
        <nav class="hidden md:flex flex-col w-64 bg-white dark:bg-gray-800 shadow-lg fixed h-full z-10">
            <div class="flex items-center gap-3 p-4 border-b dark:border-gray-700">
                <svg class="w-10 h-10 text-green-700 dark:text-green-500" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M60 20C55 25 50 30 50 40C50 50 55 55 60 60C65 65 70 70 70 80" stroke="currentColor" stroke-width="10" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M40 80C45 75 50 70 50 60C50 50 45 45 40 40C35 35 30 30 30 20" stroke="currentColor" stroke-width="10" stroke-linecap="round" stroke-linejoin="round"/>
                    <circle cx="50" cy="50" r="45" stroke="currentColor" stroke-width="8" opacity="0.3"/>
                </svg>
                <h1 class="text-xl font-bold text-green-700 dark:text-green-400">Beyond the Curve</h1>
            </div>
            
            <div class="flex-grow p-4 space-y-2">
                <button data-page="home" class="nav-link sidebar-link w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg font-semibold hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6-4h.01M12 12h.01M15 12h.01M9 12h.01M9 15h.01M12 15h.01M15 15h.01M9 18h.01M12 18h.01M15 18h.01"></path></svg>
                    Home
                </button>
                <button data-page="resources" class="nav-link sidebar-link w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg font-semibold hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5"></path></svg>
                    Resources
                </button>
                <button data-page="tracker" class="nav-link sidebar-link w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg font-semibold hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    Brace Tracker
                </button>
                <button data-page="physio" class="nav-link sidebar-link w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg font-semibold hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.636 18.364a9 9 0 010-12.728m12.728 0a9 9 0 010 12.728m-9.9-2.829a5 5 0 010-7.07m7.072 0a5 5 0 010 7.07M12 6v6h.01"></path></svg>
                    Physiotherapy
                </button>
                <button data-page="growth" class="nav-link sidebar-link w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg font-semibold hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7l4-4m0 0l4 4m-4-4v18"></path></svg>
                    Growth Tracker
                </button>
                <button data-page="journal" class="nav-link sidebar-link w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg font-semibold hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v11.494m-5.247-8.247l10.494 4.498-10.494 3.749zM3.75 6.253L14.244 1.75l-3.749 10.494L3.75 6.253z"></path></svg>
                    Journal
                </button>
                 <button data-page="community" class="nav-link sidebar-link w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg font-semibold hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-2.121l-3.37.843L11 15.111l2.52-2.52a3 3 0 00-4.14-4.14L7 10.828 3.37 8.307.247 11.677a3 3 0 002.121 5.356h5l2.828-2.828 5.657 5.657z"></path></svg>
                    Community
                </button>
                <button data-page="infographic" class="nav-link sidebar-link w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg font-semibold hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    Infographic
                </button>
                <button data-page="screener" class="nav-link sidebar-link w-full text-left flex items-center gap-3 px-3 py-2 rounded-lg font-semibold hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                    Screener
                </button>
            </div>

            <div class="p-4 border-t dark:border-gray-700">
                <div class="bg-gray-100 dark:bg-gray-700 rounded-lg p-3 flex items-center justify-center gap-3">
                    <svg class="w-8 h-8 text-gold-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343m11.314 11.314a8 8 0 00-11.314-11.314m11.314 11.314L15 21M6.343 7.343L9 3m-3.293 8.293a1 1 0 011.414 0l.001.001c.19.19.303.44.303.707v3.293a1 1 0 01-.293.707l-.001.001a1 1 0 01-1.414 0l-3.293-3.293a1 1 0 01-.293-.707V12a1 1 0 01.293-.707l.001-.001z"></path></svg>
                    <span id="streak-count" class="text-2xl font-bold text-gray-700 dark:text-gray-200">0</span>
                    <span class="font-semibold text-gray-600 dark:text-gray-300">Day Streak</span>
                </div>
            </div>

            <div class="p-4 border-t dark:border-gray-700 space-y-3">
                <button id="dark-mode-toggle" class="w-full flex items-center justify-center gap-2 bg-gray-200 dark:bg-gray-700 p-2 rounded-lg font-semibold">
                    <svg class="w-6 h-6 dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
                    <svg class="w-6 h-6 hidden dark:inline" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m8.66-15.66l-.707.707M5.05 18.95l-.707.707M3 12h1m16 0h1M5.05 5.05l.707.707M18.95 18.95l.707.707M12 5a7 7 0 100 14 7 7 0 000-14z"></path></svg>
                    Toggle Mode
                </button>

                <div id="auth-container-sidebar">
                    <button id="login-button-sidebar" class="w-full bg-green-700 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-800 transition-colors">
                        Login with Google
                    </button>
                    <div id="user-profile-sidebar" class="hidden items-center gap-2">
                        <img id="user-avatar-sidebar" class="w-10 h-10 rounded-full" src="" alt="User avatar">
                        <div class="flex-grow">
                            <span id="user-name-sidebar" class="font-semibold text-sm">User Name</span>
                            <button id="logout-button-sidebar" class="text-xs text-gray-500 dark:text-gray-400 hover:underline">Logout</button>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <div class="flex-1 md:ml-64 pb-16 md:pb-0">
            
            <header class="md:hidden bg-green-700 text-white p-4 flex justify-between items-center sticky top-0 z-10">
                <div class="flex items-center gap-3">
                    <svg class="w-10 h-10 text-white" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M60 20C55 25 50 30 50 40C50 50 55 55 60 60C65 65 70 70 70 80" stroke="currentColor" stroke-width="10" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M40 80C45 75 50 70 50 60C50 50 45 45 40 40C35 35 30 30 30 20" stroke="currentColor" stroke-width="10" stroke-linecap="round" stroke-linejoin="round"/>
                        <circle cx="50" cy="50" r="45" stroke="currentColor" stroke-width="8" opacity="0.3"/>
                    </svg>
                    <h1 class="text-xl font-bold">Beyond the Curve</h1>
                </div>
                <div id="auth-container-mobile">
                     <button id="login-button-mobile" class="bg-white text-green-700 font-semibold py-1 px-3 rounded-lg hover:bg-gray-100 text-sm">
                        Login
                    </button>
                    <div id="user-profile-mobile" class="hidden items-center gap-2">
                        <img id="user-avatar-mobile" class="w-8 h-8 rounded-full" src="" alt="User avatar">
                        <button id="logout-button-mobile" class="font-semibold text-sm hover:underline">Logout</button>
                    </div>
                </div>
            </header>
            
            <main class="p-4 md:p-8 flex-grow">
                <div id="home-page" class="page active">
                    <div class="bg-yellow-100 border-l-4 border-gold-500 text-gray-800 dark:bg-gray-800 dark:text-yellow-100 dark:border-gold-500 p-6 rounded-lg shadow-md relative overflow-hidden">
                        <div class="relative z-10">
                            <h2 class="text-3xl font-bold mb-2">Welcome to Your Scoliosis Journey Companion</h2>
                            <p class="text-lg">You're not alone. We're here to empower you with tools, community, and resources to build confidence and resilience. Let's navigate your Scoliosis journey together.</p>
                        </div>
                        <svg class="absolute -bottom-10 -right-10 text-green-200 dark:text-green-800 w-48 h-48 opacity-30" fill="currentColor" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                            <path d="M100 5C152.467 5 195 47.5329 195 100C195 152.467 152.467 195 100 195C47.5329 195 5 152.467 5 100C5 47.5329 47.5329 5 100 5Z" stroke="currentColor" stroke-width="10" stroke-linecap="round" stroke-linejoin="round" transform="rotate(30 100 100)"/>
                        </svg>
                    </div>

                    <div data-page="infographic" class="nav-link bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-green-200 dark:hover:shadow-green-900 transition-shadow flex flex-col md:flex-row items-center gap-4 mt-8 cursor-pointer">
                        <div class="flex-shrink-0 bg-green-100 dark:bg-green-900 p-3 rounded-full">
                            <svg class="w-8 h-8 text-green-700 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        </div>
                        <div class="flex-grow text-center md:text-left">
                            <h3 class="text-xl font-bold text-green-700 dark:text-green-400">What is Scoliosis?</h3>
                            <p class="mt-1">View our quick infographic to understand the basics.</p>
                        </div>
                    </div>


                    <div class="mt-8 grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div data-page="tracker" class="nav-link bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-green-200 dark:hover:shadow-green-900 transition-shadow flex flex-col cursor-pointer">
                            <div class="flex items-center gap-4">
                                <div class="bg-green-100 dark:bg-green-900 p-3 rounded-full">
                                    <svg class="w-8 h-8 text-green-700 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                </div>
                                <h3 class="text-xl font-bold text-green-700 dark:text-green-400">Daily Brace Tracker</h3>
                            </div>
                            <p class="mt-4 flex-grow">Log your brace hours, watch your progress, and earn rewards.</p>
                        </div>
                        <div data-page="physio" class="nav-link bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-green-200 dark:hover:shadow-green-900 transition-shadow flex flex-col cursor-pointer">
                            <div class="flex items-center gap-4">
                                <div class="bg-green-100 dark:bg-green-900 p-3 rounded-full">
                                    <svg class="w-8 h-8 text-green-700 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.636 18.364a9 9 0 010-12.728m12.728 0a9 9 0 010 12.728m-9.9-2.829a5 5 0 010-7.07m7.072 0a5 5 0 010 7.07M12 6v6h.01"></path></svg>
                                </div>
                                <h3 class="text-xl font-bold text-green-700 dark:text-green-400">Physiotherapy Tracker</h3>
                            </div>
                            <p class="mt-4 flex-grow">Track your daily PT sessions and stay consistent with your exercises.</p>
                        </div>
                        <div data-page="growth" class="nav-link bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-green-200 dark:hover:shadow-green-900 transition-shadow flex flex-col cursor-pointer">
                            <div class="flex items-center gap-4">
                                <div class="bg-green-100 dark:bg-green-900 p-3 rounded-full">
                                    <svg class="w-8 h-8 text-green-700 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7l4-4m0 0l4 4m-4-4v18"></path></svg>
                                </div>
                                <h3 class="text-xl font-bold text-green-700 dark:text-green-400">Growth Tracker</h3>
                            </div>
                            <p class="mt-4 flex-grow">Log your height and weight to visualize growth trends over time.</p>
                        </div>
                        <div data-page="journal" class="nav-link bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-green-200 dark:hover:shadow-green-900 transition-shadow flex flex-col cursor-pointer">
                            <div class="flex items-center gap-4">
                                <div class="bg-green-100 dark:bg-green-900 p-3 rounded-full">
                                    <svg class="w-8 h-8 text-green-700 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v11.494m-5.247-8.247l10.494 4.498-10.494 3.749zM3.75 6.253L14.244 1.75l-3.749 10.494L3.75 6.253z"></path></svg>
                                </div>
                                <h3 class="text-xl font-bold text-green-700 dark:text-green-400">Reflection Journal</h3>
                            </div>
                            <p class="mt-4 flex-grow">A private space to write, with data saved securely to your Google Drive.</p>
                        </div>
                        <div data-page="resources" class="nav-link bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-green-200 dark:hover:shadow-green-900 transition-shadow flex flex-col cursor-pointer">
                            <div class="flex items-center gap-4">
                                <div class="bg-green-100 dark:bg-green-900 p-3 rounded-full">
                                    <svg class="w-8 h-8 text-green-700 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5"></path></svg>
                                </div>
                                <h3 class="text-xl font-bold text-green-700 dark:text-green-400">Vetted Resources</h3>
                            </div>
                            <p class="mt-4 flex-grow">Find surgeons, apparel, support groups, and helpful videos all in one place.</p>
                        </div>
                         <div data-page="screener" class="nav-link bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 hover:shadow-green-200 dark:hover:shadow-green-900 transition-shadow flex flex-col cursor-pointer">
                            <div class="flex items-center gap-4">
                                <div class="bg-green-100 dark:bg-green-900 p-3 rounded-full">
                                    <svg class="w-8 h-8 text-green-700 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                                </div>
                                <h3 class="text-xl font-bold text-green-700 dark:text-green-400">Scoliosis Screener</h3>
                            </div>
                            <p class="mt-4 flex-grow">Use our guide for the Adam's Bend Test at home.</p>
                        </div>
                    </div>
                </div>

                <div id="resources-page" class="page">
                    <div class="flex items-center justify-center gap-3 mb-6">
                        <svg class="w-10 h-10 text-green-700 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5"></path></svg>
                        <h2 class="text-3xl font-bold">Vetted Resources</h2>
                    </div>

                    <div role="tablist" class="flex flex-wrap border-b border-gray-200 dark:border-gray-700 mb-6">
                        <button role="tab" data-tab-target="tab-specialists" class="resource-tab-button active text-gray-500 dark:text-gray-400 py-2 px-4 hover:text-green-700 dark:hover:text-yellow-200 transition-colors">Specialists & Orgs</button>
                        <button role="tab" data-tab-target="tab-videos" class="resource-tab-button text-gray-500 dark:text-gray-400 py-2 px-4 hover:text-green-700 dark:hover:text-yellow-200 transition-colors">Video Library</button>
                        <button role="tab" data-tab-target="tab-support" class="resource-tab-button text-gray-500 dark:text-gray-400 py-2 px-4 hover:text-green-700 dark:hover:text-yellow-200 transition-colors">Support & Apparel</button>
                        <button role="tab" data-tab-target="tab-aid" class="resource-tab-button text-gray-500 dark:text-gray-400 py-2 px-4 hover:text-green-700 dark:hover:text-yellow-200 transition-colors">Financial & General Aid</button>
                    </div>

                    <div class="space-y-8">
                        <div id="tab-specialists" class="resource-tab-panel active space-y-8">
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                                <h3 class="text-2xl font-bold mb-4 text-green-700 dark:text-green-300">Scoliosis Specialists</h3>
                                <p class="mb-4 text-gray-600 dark:text-gray-300">
                                    For the most comprehensive directory, we recommend the official Scoliosis Research Society (SRS) physician locator.
                                </p>
                                <a href="https://www.srs.org/Patients/Find-a-Specialist#" target="_blank" rel="noopener noreferrer" class="inline-block bg-green-700 text-white py-2 px-4 rounded-lg font-semibold hover:bg-green-800 transition-colors">
                                    Visit SRS Find a Specialist &rarr;
                                </a>
                            </div>

                            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                                    <h3 class="text-xl font-bold mb-4 text-green-700 dark:text-green-300">Major Organizations</h3>
                                    <ul class="space-y-3 list-disc list-inside text-green-700 dark:text-green-400">
                                        <li><a href="https://www.srs.org/" target="_blank" rel="noopener noreferrer" class="hover:underline">Scoliosis Research Society (SRS)</a></li>
                                        <li><a href="https://www.scoliosis.org/" target="_blank" rel="noopener noreferrer" class="hover:underline">National Scoliosis Foundation (NSF)</a></li>
                                        <li><a href="https://www.settingscoliosisstraight.org/" target="_blank" rel="noopener noreferrer" class="hover:underline">Setting Scoliosis Straight</a></li>
                                        <li><a href="http://www.sosort.mobi/" target="_blank" rel="noopener noreferrer" class="hover:underline">SOSORT</a></li>
                                    </ul>
                                </div>
                                 <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                                    <h3 class="text-xl font-bold mb-4 text-green-700 dark:text-green-300">Medical Institutions</h3>
                                    <ul class="space-y-3 list-disc list-inside text-green-700 dark:text-green-400">
                                        <li><a href="https://www.mayoclinic.org/diseases-conditions/scoliosis/symptoms-causes/syc-20350716" target="_blank" rel="noopener noreferrer" class="hover:underline">Mayo Clinic</a></li>
                                        <li><a href="https://www.hopkinsmedicine.org/health/conditions-and-diseases/scoliosis" target="_blank" rel="noopener noreferrer" class="hover:underline">Johns Hopkins Medicine</a></li>
                                        <li><a href="https://www.childrenshospital.org/conditions/scoliosis" target="_blank" rel="noopener noreferrer" class="hover:underline">Boston Children's Hospital</a></li>
                                        <li><a href="https://www.hss.edu/condition-list_scoliosis.asp" target="_blank" rel="noopener noreferrer" class="hover:underline">Hospital for Special Surgery (HSS)</a></li>
                                        <li><a href="https://www.shrinerschildrens.org/en/conditions/scoliosis" target="_blank" rel="noopener noreferrer" class="hover:underline">Shriners Hospitals for Children</a></li>
                                    </ul>
                                </div>
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                                    <h3 class="text-xl font-bold mb-4 text-green-700 dark:text-green-300">General Education</h3>
                                    <ul class="space-y-3 list-disc list-inside text-green-700 dark:text-green-400">
                                        <li><a href="https://medlineplus.gov/scoliosis.html" target="_blank" rel="noopener noreferrer" class="hover:underline">MedlinePlus</a></li>
                                        <li><a href="https://orthoinfo.aaos.org/en/diseases--conditions/scoliosis-in-children-and-adolescents/" target="_blank" rel="noopener noreferrer" class="hover:underline">AAOS</a></li>
                                        <li><a href="https://kidshealth.org/en/parents/scoliosis.html" target="_blank" rel="noopener noreferrer" class="hover:underline">KidsHealth</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div id="tab-videos" class="resource-tab-panel space-y-8">
                             <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                                <h3 class="text-2xl font-bold mb-4 text-green-700 dark:text-green-300">Video Library</h3>
                                <p class="mb-6 text-gray-600 dark:text-gray-300">Vetted videos covering anatomy, treatment options, and patient experiences.</p>
                                <div class="grid md:grid-cols-2 gap-6">
                                    <div>
                                        <h4 class="text-lg font-semibold mb-2">3D Rendered Videos & Basics</h4>
                                        <ul class="space-y-2 list-disc list-inside text-green-700 dark:text-green-400">
                                            <li><a href="https://www.youtube.com/watch?v=JicoSIe2JQI" target="_blank" rel="noopener noreferrer" class="hover:underline">Spine Anatomy in under 1 minute</a></li>
                                            <li><a href="https://www.youtube.com/watch?v=Vqy1VB2CuaE" target="_blank" rel="noopener noreferrer" class="hover:underline">What is Scoliosis (In under 1 Minute)</a></li>
                                            <li><a href="https://www.youtube.com/watch?v=4blk8rrfJPw" target="_blank" rel="noopener noreferrer" class="hover:underline">How to Detect Scoliosis</a></li>
                                        </ul>
                                    </div>
                                    <div>
                                        <h4 class="text-lg font-semibold mb-2">Physiotherapy & Exercises</h4>
                                        <ul class="space-y-2 list-disc list-inside text-green-700 dark:text-green-400">
                                            <li><a href="https://youtube.com/playlist?list=PLfyUArn76Mvi1yqoyEvJIEkMNf7OTG5eB&si=7hHnIFJ6klQnSDvN" target="_blank" rel="noopener noreferrer" class="hover:underline">Physiotherapy Videos for Scoliosis</a></li>
                                        </ul>
                                    </div>
                                    <div>
                                        <h4 class="text-lg font-semibold mb-2">Understanding Treatment Options</h4>
                                        <ul class="space-y-2 list-disc list-inside text-green-700 dark:text-green-400">
                                            <li><a href="https://www.youtube.com/watch?v=_nLXf5jEn5k&t=101s" target="_blank" rel="noopener noreferrer" class="hover:underline">Bracing as a Scoliosis Treatment Option</a></li>
                                            <li><a href="https://www.youtube.com/watch?v=JCDEc2uYwxA&t=18s" target="_blank" rel="noopener noreferrer" class="hover:underline">Scoliosis Surgery as a treatment option</a></li>
                                            <li><a href="https://www.youtube.com/watch?v=OX1vhVSzMiI" target="_blank" rel="noopener noreferrer" class="hover:underline">Spinal Fusion v/s VBT</a></li>
                                            <li><a href="https://www.youtube.com/watch?v=G1ynUYSqLsU" target="_blank" rel="noopener noreferrer" class="hover:underline">Hybrid Fusion (Fusion + VBT)</a></li>
                                            <li><a href="https://www.youtube.com/watch?v=s3iKfogVUyM" target="_blank" rel="noopener noreferrer" class="hover:underline">General info on Scoliosis</a></li>
                                        </ul>
                                    </div>
                                    <div>
                                        <h4 class="text-lg font-semibold mb-2">Surgery Experience & Interviews</h4>
                                        <ul class="space-y-2 list-disc list-inside text-green-700 dark:text-green-400">
                                            <li><a href="https://youtube.com/playlist?list=PLfyUArn76MviC3wiB67PdATXA3EJGfQlc&si=ZSU0NonH0itejvzV" target="_blank" rel="noopener noreferrer" class="hover:underline">Vertebral Body Tethering (VBT)</a></li>
                                            <li><a href="https://youtu.be/WID1p_UJZIM?si=S-c6FJ525PfS6GU2" target="_blank" rel="noopener noreferrer" class="hover:underline">Spinal Fusion Details</a></li>
                                            <li><a href="https://www.youtube.com/watch?v=3gKel6MwW98&t=12s" target="_blank" rel="noopener noreferrer" class="hover:underline">What to Expect Before and After Surgery</a></li>
                                            <li><a href="https://www.youtube.com/watch?v=L8kHuCjqXyo" target="_blank" rel="noopener noreferrer" class="hover:underline">Hospital Stay Checklist</a></li>
                                            <li><a href="https://www.youtube.com/watch?v=YHKTELBwreo&t=21s" target="_blank" rel="noopener noreferrer" class="hover:underline">Life Post-Surgery</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="tab-support" class="resource-tab-panel space-y-8">
                            <div class="grid md:grid-cols-2 gap-6">
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                                    <h3 class="text-xl font-bold mb-4 text-green-700 dark:text-green-300">Support Groups & Forums</h3>
                                    <ul class="space-y-3 list-disc list-inside text-green-700 dark:text-green-400">
                                        <li><a href="https://www.curvygirlsscoliosis.com/" target="_blank" rel="noopener noreferrer" class="hover:underline">Curvy Girls International</a></li>
                                        <li><a href="https://www.scoliboys.com/" target="_blank" rel="noopener noreferrer" class="hover:underline">ScoliBoys Support</a></li>
                                        <li><a href="https://scolios-us.org/" target="_blank" rel="noopener noreferrer" class="hover:underline">Scolio-US</a></li>
                                        <li><a href="https://www.higgybears.com/" target="_blank" rel="noopener noreferrer" class="hover:underline">Higgy Bears</a></li>
                                        <li><a href="https://www.facebook.com/groups/ScoliosisParents/" target="_blank" rel="noopener noreferrer" class="hover:underline">Facebook Support Group</a></li>
                                    </ul>
                                </div>
                                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                                    <h3 class="text-xl font-bold mb-4 text-green-700 dark:text-green-300">Brace-Friendly Apparel</h3>
                                    <ul class="space-y-3 list-disc list-inside text-green-700 dark:text-green-400">
                                        <li><a href="https://www.hopescloset.co/" target="_blank" rel="noopener noreferrer" class="hover:underline">Hope's Closet</a></li>
                                        <li><a href="https://www.brace-tee.com/" target="_blank" rel="noopener noreferrer" class="hover:underline">Brace-Tee</a></li>
                                        <li><a href="https://embracedincomfort.com/" target="_blank" rel="noopener noreferrer" class="hover:underline">Embraced in Comfort</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div id="tab-aid" class="resource-tab-panel space-y-8">
                             <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                                <h3 class="text-xl font-bold mb-4 text-green-700 dark:text-green-300">Financial/Practical Aid</h3>
                                <p class="mb-4 text-gray-600 dark:text-gray-300">Resources to help with medical costs and transportation for care.</p>
                                <ul class="space-y-3 list-disc list-inside text-green-700 dark:text-green-400">
                                    <li><a href="https://www.childrensscoliosisfoundation.org/" target="_blank" rel="noopener noreferrer" class="hover:underline">Children's Scoliosis Foundation</a></li>
                                    <li><a href="https://www.uhccf.org/" target="_blank" rel="noopener noreferrer" class="hover:underline">UnitedHealthcare Children's Foundation</a></li>
                                    <li><a href="https://www.mercymedicalangels.org/" target="_blank" rel="noopener noreferrer" class="hover:underline">Mercy Medical Angels</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="tracker-page" class="page">
                    <div class="login-prompt text-center p-8 bg-gray-100 dark:bg-gray-800 rounded-lg">
                        <h3 class="text-2xl font-bold mb-4">Login to Track Your Progress</h3>
                        <p class="mb-6">Please log in with your Google account to use the Brace Tracker. Your data will be stored safely in your own Google Drive.</p>
                        <button id="login-button-tracker" class="bg-green-700 text-white font-semibold py-2 px-6 rounded-lg hover:bg-green-800 transition-colors">Login with Google</button>
                    </div>
                    <div class="protected-content">
                        <div class="flex items-center justify-between py-4 border-b border-gray-700">
                            <svg class="w-8 h-8 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                            <h2 id="tracker-greeting" class="text-xl font-semibold text-green-500">Hi, User! Keep It Up!</h2>
                            <div class="relative">
                                <svg class="w-8 h-8 text-gold-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.406L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg>
                                <span class="absolute top-0 right-0 block h-2 w-2 rounded-full ring-2 ring-gray-900 bg-gold-500"></span>
                            </div>
                        </div>

                        <div class="flex justify-center my-10 relative">
                            <div id="main-brace-meter" class="progress-circle w-3/5 max-w-xs">
                                <svg viewBox="0 0 36 36" class="absolute">
                                    <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" stroke="#2a2a2a"/>
                                    <path id="circle-progress" class="circle-progress" stroke="#10B981" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" stroke-linecap="round"/>
                                </svg>
                                <div class="absolute inset-0 flex flex-col items-center justify-center p-4">
                                    <span class="text-sm font-medium text-gray-400 uppercase">BRACE WEAR TIME</span>
                                    <span id="meter-hours" class="text-5xl font-bold text-gold-500 my-1">0:00 hrs</span>
                                    <span id="meter-goal" class="text-sm text-green-500">Goal: 18:00 hrs</span>
                                </div>
                                <div class="absolute top-2 right-2 text-gold-500 flex items-center gap-1">
                                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l2.074 6.398h6.732c.969 0 1.371 1.24.588 1.81l-5.464 3.974 2.075 6.398c.3.921-.755 1.688-1.538 1.111l-5.464-3.974-5.464 3.974c-.783.57-1.838-.19-1.538-1.111l2.075-6.398-5.464-3.974c-.783-.57-.381-1.81.588-1.81h6.732l2.074-6.398z"></path></svg>
                                    <span id="meter-streak" class="font-bold">0</span>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4 mb-8">
                            <div class="bg-gray-800 p-4 rounded-xl shadow-lg border border-gray-700 flex flex-col items-center">
                                <span class="text-sm font-medium text-gray-400 uppercase mb-2">BRACE TIGHTNESS GOAL</span>
                                <div id="tightness-meter" class="progress-circle w-20 h-20">
                                     <svg viewBox="0 0 36 36" class="absolute">
                                        <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" stroke="#2a2a2a" stroke-width="4"/>
                                        <path id="tightness-progress" class="circle-progress" stroke="#eab308" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" stroke-linecap="round" stroke-width="4"/>
                                    </svg>
                                     <div class="absolute inset-0 flex flex-col items-center justify-center">
                                        <span id="tightness-text" class="text-lg font-bold text-gold-500">95%</span>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gray-800 p-4 rounded-xl shadow-lg border border-gray-700 flex flex-col items-center">
                                <span class="text-sm font-medium text-gray-400 uppercase mb-2">ACTIVITY LEVEL</span>
                                <div id="activity-meter" class="progress-circle w-20 h-20">
                                    <svg viewBox="0 0 36 36" class="absolute">
                                        <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" stroke="#2a2a2a" stroke-width="4"/>
                                        <path id="activity-progress" class="circle-progress" stroke="#86efac" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" stroke-linecap="round" stroke-width="4"/>
                                    </svg>
                                    <div class="absolute inset-0 flex flex-col items-center justify-center">
                                        <span id="activity-text" class="text-lg font-bold text-green-400">Med</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 gap-4 mb-8">
                            <button id="brace-timer-button" class="bg-green-700 text-white font-bold py-4 rounded-xl shadow-lg flex items-center justify-center space-x-3 hover:bg-green-800 transition-colors">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                <span>Start/Pause Brace Timer</span>
                            </button>
                            <button data-page="brace-log-form" id="brace-tightness-log-button" class="bg-gold-500 text-gray-900 font-bold py-4 rounded-xl shadow-lg flex items-center justify-center space-x-3 hover:bg-gold-600 transition-colors">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2m-9 0V3h4v2m-4 0h4m-4 0h4m-4 0h4m-4 0h4m-4 0h4m-4 0h4m-4 0h4m-4 0h4"></path></svg>
                                <span>Log Tightness Check-In</span>
                            </button>
                        </div>

                        <p class="text-center text-sm italic text-gray-500 dark:text-gray-400">
                            Small progress is still progress.
                        </p>
                        
                        <div class="mt-8 bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700">
                            <h3 class="text-xl font-bold mb-4">Manual Log Entry</h3>
                            <form id="brace-form" class="space-y-4">
                                <div>
                                    <label for="brace-date" class="block font-semibold">Date</label>
                                    <input type="date" id="brace-date" class="w-full p-2 border border-gray-600 rounded-lg mt-1 bg-gray-700" required>
                                </div>
                                <div>
                                    <label for="brace-hours" class="block font-semibold">Hours Worn</label>
                                    <input type="number" id="brace-hours" min="0" max="24" step="0.5" class="w-full p-2 border border-gray-600 rounded-lg mt-1 bg-gray-700" placeholder="e.g., 18.5" required>
                                </div>
                                <div>
                                    <label for="daily-goal" class="block font-semibold">Daily Goal (hours)</label>
                                    <input type="number" id="daily-goal" min="1" max="24" step="1" class="w-full p-2 border border-gray-600 rounded-lg mt-1 bg-gray-700" value="18">
                                </div>
                                <button type="submit" class="w-full bg-green-700 text-white py-2 rounded-lg font-semibold hover:bg-green-800 transition-colors">Log Hours</button>
                            </form>
                        </div>

                        <div class="mt-8 bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-700">
                            <h3 class="text-xl font-bold mb-4">Weekly Progress Chart</h3>
                            <canvas id="brace-chart"></canvas>
                        </div>
                    </div>
                </div>

                <div id="physio-page" class="page">
                    <div class="login-prompt text-center p-8 bg-gray-100 dark:bg-gray-800 rounded-lg">
                        <h3 class="text-2xl font-bold mb-4">Login to Track Your Physiotherapy</h3>
                        <p class="mb-6">Please log in with your Google account to use the PT Tracker. Your data will be stored safely in your own Google Drive.</p>
                        <button id="login-button-physio" class="bg-green-700 text-white font-semibold py-2 px-6 rounded-lg hover:bg-green-800 transition-colors">Login with Google</button>
                    </div>
                    <div class="protected-content">
                        <div class="flex items-center justify-center gap-3 mb-6">
                            <svg class="w-10 h-10 text-green-700 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.636 18.364a9 9 0 010-12.728m12.728 0a9 9 0 010 12.728m-9.9-2.829a5 5 0 010-7.07m7.072 0a5 5 0 010 7.07M12 6v6h.01"></path></svg>
                            <h2 class="text-3xl font-bold text-center">My Physiotherapy Tracker</h2>
                        </div>
                        <div class="grid md:grid-cols-2 gap-8">
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                                <h3 class="text-xl font-bold mb-4">Log Today's Session</h3>
                                <form id="physio-form" class="space-y-4">
                                    <div>
                                        <label for="physio-date" class="block font-semibold">Date</label>
                                        <input type="date" id="physio-date" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg mt-1 bg-gray-50 dark:bg-gray-700" required>
                                    </div>
                                    <div>
                                        <label for="physio-minutes" class="block font-semibold">Minutes of PT</label>
                                        <input type="number" id="physio-minutes" min="0" max="240" step="1" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg mt-1 bg-gray-50 dark:bg-gray-700" placeholder="e.g., 45" required>
                                    </div>
                                    <div>
                                        <label for="physio-daily-goal" class="block font-semibold">Daily Goal (minutes)</label>
                                        <input type="number" id="physio-daily-goal" min="1" max="240" step="1" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg mt-1 bg-gray-50 dark:bg-gray-700" value="30">
                                    </div>
                                    <button type="submit" class="w-full bg-green-700 text-white py-2 rounded-lg font-semibold hover:bg-green-800 dark:hover:bg-green-600 transition-colors">Log Session</button>
                                </form>
                            </div>
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                                <h3 class="text-xl font-bold mb-4">Today's Progress</h3>
                                <div>
                                    <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-8">
                                        <div id="physio-progress-bar" class="progress-bar-fill bg-green-700 h-8 text-white text-center font-bold leading-8 rounded-full" style="width: 0%;">0%</div>
                                    </div>
                                    <p id="physio-progress-text" class="text-center mt-2 font-semibold">Log your session to see your progress!</p>
                                </div>
                                <div class="mt-6">
                                    <h3 class="text-xl font-bold mb-4">My PT Rewards</h3>
                                    <div id="physio-rewards-container" class="flex flex-wrap gap-4">
                                        <p class="text-gray-500 dark:text-gray-400">Start logging to earn badges!</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-8 bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                            <h3 class="text-xl font-bold mb-4">Weekly PT Progress</h3>
                            <canvas id="physio-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <div id="growth-page" class="page">
                    <div class="login-prompt text-center p-8 bg-gray-100 dark:bg-gray-800 rounded-lg">
                        <h3 class="text-2xl font-bold mb-4">Login to Track Your Growth</h3>
                        <p class="mb-6">Please log in with your Google account to use the Growth Tracker. Your data will be stored safely in your own Google Drive.</p>
                        <button id="login-button-growth" class="bg-green-700 text-white font-semibold py-2 px-6 rounded-lg hover:bg-green-800 transition-colors">Login with Google</button>
                    </div>
                    <div class="protected-content">
                        <div class="flex items-center justify-center gap-3 mb-6">
                            <svg class="w-10 h-10 text-green-700 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7l4-4m0 0l4 4m-4-4v18"></path></svg>
                            <h2 class="text-3xl font-bold text-center">My Growth Tracker</h2>
                        </div>
                        <div class="grid md:grid-cols-2 gap-8">
                            <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                                <h3 class="text-xl font-bold mb-4">Log New Measurement</h3>
                                <form id="growth-form" class="space-y-4">
                                    <div>
                                        <label for="growth-date" class="block font-semibold">Date</label>
                                        <input type="date" id="growth-date" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg mt-1 bg-gray-50 dark:bg-gray-700" required>
                                    </div>
                                    <div>
                                        <label for="growth-height" class="block font-semibold">Height (cm)</label>
                                        <input type="number" id="growth-height" min="0" step="0.1" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg mt-1 bg-gray-50 dark:bg-gray-700" placeholder="e.g., 150.5" required>
                                    </div>
                                    <div>
                                        <label for="growth-weight" class="block font-semibold">Weight (kg)</label>
                                        <input type="number" id="growth-weight" min="0" step="0.1" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg mt-1 bg-gray-50 dark:bg-gray-700" placeholder="e.g., 45.2">
                                    </div>
                                    <button type="submit" class="w-full bg-green-700 text-white py-2 rounded-lg font-semibold hover:bg-green-800 dark:hover:bg-green-600 transition-colors">Log Measurement</button>
                                </form>
                            </div>
                             <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                                <svg class="w-full h-32 text-green-200 dark:text-green-700" fill="currentColor" viewBox="0 0 100 100" preserveAspectRatio="none">
                                    <path d="M0 100 C 20 80, 40 80, 50 90 S 80 100, 100 80 L 100 100 Z"></path>
                                    <path d="M0 100 C 15 70, 35 70, 50 80 S 80 90, 100 70 L 100 100 Z" opacity="0.5"></path>
                                </svg>
                                <h3 class="text-xl font-bold mb-2 -mt-8 text-center relative z-10">Growth Trends</h3>
                                <p class="text-center relative z-10">Log your measurements to see your growth curve projected here.</p>
                            </div>
                        </div>
                        <div class="mt-8 bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                            <h3 class="text-xl font-bold mb-4">Growth Chart</h3>
                            <canvas id="growth-chart"></canvas>
                        </div>
                    </div>
                </div>

                <div id="journal-page" class="page">
                    <div class="login-prompt text-center p-8 bg-gray-100 dark:bg-gray-800 rounded-lg">
                        <h3 class="text-2xl font-bold mb-4">Login to Use Your Journal</h3>
                        <p class="mb-6">Please log in with your Google account to use the Reflection Journal. Your entries will be stored safely and privately in your own Google Drive.</p>
                        <button id="login-button-journal" class="bg-green-700 text-white font-semibold py-2 px-6 rounded-lg hover:bg-green-800 transition-colors">Login with Google</button>
                    </div>
                    <div class="protected-content">
                        <div class="flex items-center justify-center gap-3 mb-6">
                            <svg class="w-10 h-10 text-green-700 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v11.494m-5.247-8.247l10.494 4.498-10.494 3.749zM3.75 6.253L14.244 1.75l-3.749 10.494L3.75 6.253z"></path></svg>
                            <h2 class="text-3xl font-bold">My Reflection Journal</h2>
                        </div>
                        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700">
                            <form id="journal-form">
                                <h3 class="text-xl font-bold mb-2">New Entry</h3>
                                <p class="text-gray-600 dark:text-gray-300 mb-4">How are you feeling today? This is your private space.</p>
                                <textarea id="journal-entry" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700" rows="8" placeholder="Write about your day, your thoughts, or anything on your mind..."></textarea>
                                <div class="flex justify-end mt-4">
                                    <button type="submit" class="bg-green-700 text-white py-2 px-6 rounded-lg font-semibold hover:bg-green-800 dark:hover:bg-green-600 transition-colors">Save Entry</button>
                                </div>
                            </form>
                        </div>
                        <div class="mt-8">
                            <h3 class="text-2xl font-bold mb-4">Past Entries</h3>
                            <div id="journal-entries-container" class="space-y-6">
                                <p class="text-gray-500 dark:text-gray-400">Your saved entries will appear here.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="community-page" class="page">
                    <div class="flex items-center justify-center gap-3 mb-6">
                        <svg class="w-10 h-10 text-green-700 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-2.121l-3.37.843L11 15.111l2.52-2.52a3 3 0 00-4.14-4.14L7 10.828 3.37 8.307.247 11.677a3 3 0 002.121 5.356h5l2.828-2.828 5.657 5.657z"></path></svg>
                        <h2 class="text-3xl font-bold">Community Hub</h2>
                    </div>
                    <div class="bg-white dark:bg-gray-800 p-8 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 text-center">
                        <h3 class="text-2xl font-bold text-gold-500 dark:text-gold-400 mb-4">Coming Soon!</h3>
                        <p class="text-lg text-gray-600 dark:text-gray-300">
                            A safe, moderated forum for kids and parents to share experiences is on its way.
                        </p>
                        <p class="mt-2 text-gray-600 dark:text-gray-300">We're building separate, age-appropriate spaces for you to connect with peers who understand your journey.</p>
                    </div>
                </div>

                <div id="infographic-page" class="page">
                    <div class="flex items-center justify-center gap-3 mb-6">
                        <svg class="w-10 h-10 text-green-700 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        <h2 class="text-3xl font-bold">What is Scoliosis?</h2>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden">
                        <iframe src="scoliosis_infographic.html" class="w-full min-h-[80vh] border-0" title="Scoliosis Infographic"></iframe>
                    </div>
                </div>

                <div id="screener-page" class="page">
                    <div class="flex items-center justify-center gap-3 mb-6">
                         <svg class="w-10 h-10 text-green-700 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                        <h2 class="text-3xl font-bold">Scoliosis Screener</h2>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 overflow-hidden">
                        <iframe src="adams_bend_test.html" class="w-full min-h-[80vh] border-0" title="Scoliosis Screener - Adam's Bend Test"></iframe>
                    </div>
                </div>

            </main>
        </div>

        <nav class="md:hidden fixed bottom-0 left-0 right-0 h-16 bg-white dark:bg-gray-800 shadow-inner z-10 flex justify-around items-center border-t dark:border-gray-700">
            <button data-page="home" class="nav-link bottom-nav-link flex flex-col items-center justify-center text-gray-600 dark:text-gray-300">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3"></path></svg>
                <span class="text-xs font-semibold">Home</span>
            </button>
            <button data-page="resources" class="nav-link bottom-nav-link flex flex-col items-center justify-center text-gray-600 dark:text-gray-300">
                 <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5"></path></svg>
                <span class="text-xs font-semibold">Resources</span>
            </button>
            <button data-page="tracker" class="nav-link bottom-nav-link flex flex-col items-center justify-center text-gray-600 dark:text-gray-300">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                <span class="text-xs font-semibold">Brace</span>
            </button>
            <button data-page="physio" class="nav-link bottom-nav-link flex flex-col items-center justify-center text-gray-600 dark:text-gray-300">
                 <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.636 18.364a9 9 0 010-12.728m12.728 0a9 9 0 010 12.728"></path></svg>
                <span class="text-xs font-semibold">Physio</span>
            </button>
            <button data-page="journal" class="nav-link bottom-nav-link flex flex-col items-center justify-center text-gray-600 dark:text-gray-300">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v11.494m-5.247-8.247l10.494 4.498-10.494 3.749z"></path></svg>
                <span class="text-xs font-semibold">Journal</span>
            </button>
        </nav>
    </div>

    <script>
        const app = {
            // STATE
            googleGisReady: false,
            tokenClient: null,
            accessToken: null,
            fileId: null,
            isLoggedIn: false,
            userInfo: null,
            
            // App Data Object
            data: {
                braceData: {},
                physioData: {},
                growthData: {},
                journalData: [],
                gamification: {
                    streak: 0,
                    lastLogDate: null
                }
            },
            
            // UI ELEMENTS
            pages: null, navLinks: null,
            loginButtons: [],
            logoutButtons: [],
            userProfiles: [],
            userAvatars: [],
            appContainer: null,
            streakCount: null,
            darkModeToggle: null,

            // Brace Tracker
            braceForm: null, braceDate: null, braceHours: null, dailyGoal: null,
            progressBar: null, progressText: null, rewardsContainer: null, braceChart: null,
            
            // Physio Tracker
            physioForm: null, physioDate: null, physioMinutes: null, physioDailyGoal: null,
            physioProgressBar: null, physioProgressText: null, physioRewardsContainer: null, physioChart: null,
            
            // Growth Tracker
            growthForm: null, growthDate: null, growthHeight: null, growthWeight: null, growthChart: null,

            // Journal
            journalForm: null, journalEntry: null, journalEntriesContainer: null,

            // Resources Tabs
            resourceTabButtons: null,
            
            // --- INITIALIZATION ---
            async init() {
                if (this.googleGisReady) {
                    await this.setupApp();
                }
            },

            async setupApp() {
                // Query selectors
                this.appContainer = document.getElementById('app');
                this.pages = document.querySelectorAll('.page');
                this.navLinks = document.querySelectorAll('.nav-link');
                
                // Auth Elements
                this.loginButtons = [
                    document.getElementById('login-button-sidebar'),
                    document.getElementById('login-button-mobile'),
                    document.getElementById('login-button-tracker'),
                    document.getElementById('login-button-physio'),
                    document.getElementById('login-button-growth'),
                    document.getElementById('login-button-journal'),
                ];
                this.logoutButtons = [
                    document.getElementById('logout-button-sidebar'),
                    document.getElementById('logout-button-mobile'),
                ];
                this.userProfiles = [
                    document.getElementById('user-profile-sidebar'),
                    document.getElementById('user-profile-mobile'),
                ];
                this.userAvatars = [
                    document.getElementById('user-avatar-sidebar'),
                    document.getElementById('user-avatar-mobile'),
                ];

                // Gamification
                this.streakCount = document.getElementById('streak-count');
                this.darkModeToggle = document.getElementById('dark-mode-toggle');

                // Brace Tracker
                this.braceForm = document.getElementById('brace-form');
                this.braceDate = document.getElementById('brace-date');
                this.braceHours = document.getElementById('brace-hours');
                this.dailyGoal = document.getElementById('daily-goal');
                this.progressBar = document.getElementById('progress-bar');
                this.progressText = document.getElementById('progress-text');
                this.rewardsContainer = document.getElementById('rewards-container');
                
                // Physio Tracker
                this.physioForm = document.getElementById('physio-form');
                this.physioDate = document.getElementById('physio-date');
                this.physioMinutes = document.getElementById('physio-minutes');
                this.physioDailyGoal = document.getElementById('physio-daily-goal');
                this.physioProgressBar = document.getElementById('physio-progress-bar');
                this.physioProgressText = document.getElementById('physio-progress-text');
                this.physioRewardsContainer = document.getElementById('physio-rewards-container');
                
                // Growth Tracker
                this.growthForm = document.getElementById('growth-form');
                this.growthDate = document.getElementById('growth-date');
                this.growthHeight = document.getElementById('growth-height');
                this.growthWeight = document.getElementById('growth-weight');

                // Journal
                this.journalForm = document.getElementById('journal-form');
                this.journalEntry = document.getElementById('journal-entry');
                this.journalEntriesContainer = document.getElementById('journal-entries-container');
                
                // Resources Tabs
                this.resourceTabButtons = document.querySelectorAll('.resource-tab-button');

                // Event Listeners
                this.setupEventListeners();

                // Initial UI State
                this.initDarkMode();
                const lastPage = localStorage.getItem('lastPage') || 'home';
                this.navigateTo(lastPage);
                
                this.braceDate.valueAsDate = new Date();
                this.physioDate.valueAsDate = new Date();
                this.growthDate.valueAsDate = new Date();
                
                this.handleVisitorCounter();

                // Initialize Google Auth Client
                const GOOGLE_CLIENT_ID = "704532323173-lks375tr64fg63iok7bm1sn0slao6nge.apps.googleusercontent.com";
                const SCOPES = 'https://www.googleapis.com/auth/drive.appdata https://www.googleapis.com/auth/userinfo.profile';
                
                this.tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: GOOGLE_CLIENT_ID,
                    scope: SCOPES,
                    callback: async (tokenResponse) => {
                        if (tokenResponse && tokenResponse.access_token) {
                            this.accessToken = tokenResponse.access_token;
                            this.isLoggedIn = true;
                            await this.onLoginSuccess();
                        } else if (tokenResponse.error) {
                             console.log(`GSI Error: ${tokenResponse.error}`);
                            this.isLoggedIn = false;
                            this.updateUiForAuthState();
                        }
                    },
                });

                this.tokenClient.requestAccessToken({ prompt: 'none' });
            },
            
            async onLoginSuccess() {
                await this.fetchUserInfo();
                await this.findOrCreateDataFile(); // This will load data
                this.updateUiForAuthState();
            },

            setupEventListeners() {
                this.navLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        this.navigateTo(e.currentTarget.dataset.page);
                    });
                });
                
                this.loginButtons.forEach(btn => btn?.addEventListener('click', () => this.handleAuthClick()));
                this.logoutButtons.forEach(btn => btn?.addEventListener('click', () => this.handleSignoutClick()));
                
                this.darkModeToggle?.addEventListener('click', () => this.toggleDarkMode());

                // Form Submissions
                this.braceForm?.addEventListener('submit', (e) => this.handleBraceSubmit(e));
                this.physioForm?.addEventListener('submit', (e) => this.handlePhysioSubmit(e));
                this.growthForm?.addEventListener('submit', (e) => this.handleGrowthSubmit(e));
                this.journalForm?.addEventListener('submit', (e) => this.handleJournalSubmit(e));
                
                // Resources Tabs
                this.resourceTabButtons.forEach(button => {
                    button.addEventListener('click', (e) => this.handleResourceTabClick(e.currentTarget.dataset.tabTarget));
                });
            },
            
            handleResourceTabClick(targetId) {
                // Deactivate all buttons and panels
                this.resourceTabButtons.forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.resource-tab-panel').forEach(panel => panel.classList.remove('active'));

                // Activate the clicked button and corresponding panel
                document.querySelector(`[data-tab-target="${targetId}"]`).classList.add('active');
                document.getElementById(targetId).classList.add('active');
                localStorage.setItem('resourcesActiveTab', targetId);
            },
            
            setupResourceTabs() {
                const defaultTab = 'tab-specialists';
                const activeTab = localStorage.getItem('resourcesActiveTab') || defaultTab;
                
                // Ensure the active tab exists, otherwise fall back to default
                if (!document.getElementById(activeTab)) {
                     this.handleResourceTabClick(defaultTab);
                } else {
                     this.handleResourceTabClick(activeTab);
                }
            },

            handleVisitorCounter() {
                let count = localStorage.getItem('visitorCount') || 0;
                count++;
                localStorage.setItem('visitorCount', count);
                // No counter element in the new design
            },
            
            // --- Dark Mode ---
            initDarkMode() {
                if (localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            },
            toggleDarkMode() {
                if (document.documentElement.classList.contains('dark')) {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('theme', 'light');
                } else {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('theme', 'dark');
                }
            },

            // --- UI State ---
            updateUiForAuthState() {
                if (this.isLoggedIn && this.userInfo) {
                    this.appContainer.classList.add('logged-in');
                    document.getElementById('login-button-sidebar').classList.add('hidden');
                    document.getElementById('login-button-mobile').classList.add('hidden');
                    document.getElementById('user-profile-sidebar').classList.remove('hidden');
                    document.getElementById('user-profile-sidebar').classList.add('flex');
                    document.getElementById('user-profile-mobile').classList.remove('hidden');
                    document.getElementById('user-profile-mobile').classList.add('flex');
                    document.getElementById('user-avatar-sidebar').src = this.userInfo.picture;
                    document.getElementById('user-avatar-mobile').src = this.userInfo.picture;
                    document.getElementById('user-name-sidebar').textContent = this.userInfo.name;
                } else {
                    this.appContainer.classList.remove('logged-in');
                    document.getElementById('login-button-sidebar').classList.remove('hidden');
                    document.getElementById('login-button-mobile').classList.remove('hidden');
                    document.getElementById('user-profile-sidebar').classList.add('hidden');
                    document.getElementById('user-profile-mobile').classList.add('hidden');
                    this.fileId = null;
                    this.data = { braceData: {}, physioData: {}, growthData: {}, journalData: [], gamification: { streak: 0, lastLogDate: null } };
                    this.loadAllData();
                }
            },

            navigateTo(pageId) {
                if (!pageId) pageId = 'home';
                
                this.pages.forEach(page => page.classList.remove('active'));
                const targetPage = document.getElementById(`${pageId}-page`);
                if (targetPage) {
                    targetPage.classList.add('active');
                    if (pageId === 'resources') {
                        this.setupResourceTabs();
                    }
                }
                
                localStorage.setItem('lastPage', pageId);

                // Update active state for nav links
                document.querySelectorAll('.sidebar-link, .bottom-nav-link').forEach(link => {
                    link.classList.remove('active');
                    if (link.dataset.page === pageId) {
                        link.classList.add('active');
                    }
                });
            },

            // --- Google Auth & Drive Methods ---
            handleAuthClick() {
                this.tokenClient.requestAccessToken({ prompt: 'consent' });
            },
            handleSignoutClick() {
                if (this.accessToken) {
                    google.accounts.oauth2.revoke(this.accessToken, () => {
                        this.accessToken = null;
                        this.isLoggedIn = false;
                        this.updateUiForAuthState();
                    });
                }
            },
            async fetchUserInfo() {
                if (!this.accessToken) return;
                try {
                    const response = await fetch('https://www.googleapis.com/oauth2/v3/userinfo', {
                        headers: { 'Authorization': `Bearer ${this.accessToken}` }
                    });
                    if (!response.ok) throw new Error('Failed to fetch user info');
                    const userInfo = await response.json();
                    this.userInfo = { name: userInfo.name, picture: userInfo.picture };
                } catch (error) {
                    console.error("Error fetching user info:", error);
                    this.userInfo = null;
                }
            },
            async findOrCreateDataFile() {
                if (!this.accessToken) return;
                try {
                    const response = await fetch("https://www.googleapis.com/drive/v3/files?q=name='beyond-the-curve-data.json'&spaces=appDataFolder&fields=files(id,name)", {
                        headers: { 'Authorization': `Bearer ${this.accessToken}` }
                    });
                    const data = await response.json();

                    if (data.files && data.files.length > 0) {
                        this.fileId = data.files[0].id;
                        await this.loadDataFromDrive();
                    } else {
                        const fileMetadata = {
                            'name': 'beyond-the-curve-data.json',
                             'parents': ['appDataFolder']
                        };
                         const createResponse = await fetch("https://www.googleapis.com/drive/v3/files", {
                            method: 'POST',
                            headers: {
                                'Authorization': `Bearer ${this.accessToken}`,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(fileMetadata)
                        });
                        const newFile = await createResponse.json();
                        this.fileId = newFile.id;
                        await this.saveDataToDrive(); 
                    }
                } catch (err) {
                    console.error("Error finding or creating file", err);
                }
            },
            async loadDataFromDrive() {
                if (!this.fileId || !this.accessToken) return;
                try {
                    const response = await fetch(`https://www.googleapis.com/drive/v3/files/${this.fileId}?alt=media`, {
                         headers: { 'Authorization': `Bearer ${this.accessToken}` }
                    });
                    if (response.status === 200) {
                        const text = await response.text();
                         if (text) {
                            const loadedData = JSON.parse(text);
                            // Merge loaded data with defaults to prevent errors
                            this.data = {
                                braceData: loadedData.braceData || {},
                                physioData: loadedData.physioData || {},
                                growthData: loadedData.growthData || {},
                                journalData: loadedData.journalData || [],
                                gamification: loadedData.gamification || { streak: 0, lastLogDate: null }
                            };
                        } else {
                           throw new Error("Empty response from Drive");
                        }
                    }
                } catch (e) {
                    console.log("Could not parse JSON from Drive, file may be new or empty.", e);
                } finally {
                    this.loadAllData();
                }
            },
            async saveDataToDrive() {
                if (!this.fileId || !this.accessToken) return;
                try {
                    await fetch(`https://www.googleapis.com/upload/drive/v3/files/${this.fileId}?uploadType=media`, {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `Bearer ${this.accessToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(this.data) // Save the entire data object
                    });
                } catch (err) {
                    console.error("Error saving data to drive", err);
                }
            },
            
            // Load all data into UI
            loadAllData() {
                this.loadBraceData();
                this.loadPhysioData();
                this.loadGrowthData();
                this.loadJournalData();
                this.updateStreak();
            },

            // --- Gamification ---
            updateStreak() {
                const today = new Date().toISOString().split('T')[0];
                const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
                
                const lastLog = this.data.gamification.lastLogDate;
                
                if (lastLog && lastLog !== today && lastLog !== yesterday) {
                    this.data.gamification.streak = 0; // Reset streak
                }
                
                this.streakCount.textContent = this.data.gamification.streak;
            },
            
            async logActivity() {
                const today = new Date().toISOString().split('T')[0];
                const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
                const lastLog = this.data.gamification.lastLogDate;

                if (lastLog !== today) {
                    if (lastLog === yesterday) {
                        this.data.gamification.streak++;
                    } else {
                        this.data.gamification.streak = 1;
                    }
                    this.data.gamification.lastLogDate = today;
                    this.streakCount.textContent = this.data.gamification.streak;
                    await this.saveDataToDrive();
                }
            },

            // --- Brace Tracker Methods ---
            async handleBraceSubmit(e) { 
                e.preventDefault(); 
                const date = this.braceDate.value; 
                const hours = parseFloat(this.braceHours.value); 
                const goal = parseFloat(this.dailyGoal.value); 
                
                if (!date || isNaN(hours) || isNaN(goal)) { return; } 
                
                this.data.braceData[date] = { hours, goal }; 
                await this.logActivity(); 
                await this.saveDataToDrive(); 
                
                this.updateProgressUI(date); 
                this.updateChart(); 
                this.updateRewards(); 
                
                this.braceForm.reset(); 
                this.braceDate.valueAsDate = new Date(); 
            },
            
            loadBraceData() { 
                const today = new Date().toISOString().split('T')[0]; 
                this.updateProgressUI(today); 
                this.updateChart(); 
                this.updateRewards();
                // Placeholder for new rings
                this.updateTightnessUI();
                this.updateActivityUI(); 
            },
            
            updateProgressUI(date) { 
                const data = this.data.braceData[date]; 
                const hoursElement = document.getElementById('meter-hours');
                const goalElement = document.getElementById('meter-goal');
                const progressCircle = document.getElementById('circle-progress');
                
                let currentHours = 0;
                let dailyGoal = parseFloat(this.dailyGoal.value); // Use form value as default
                
                if (data) {
                    currentHours = data.hours;
                    dailyGoal = data.goal;
                }
                
                const percentage = Math.min(100, (currentHours / dailyGoal) * 100);
                
                // Update text elements
                hoursElement.textContent = `${currentHours.toFixed(1)} hrs`;
                goalElement.textContent = `Goal: ${dailyGoal.toFixed(1)} hrs`;

                // Update the circular meter
                const radius = 15.9155;
                const circumference = 2 * Math.PI * radius;
                const offset = circumference - (percentage / 100) * circumference;
                
                progressCircle.style.strokeDasharray = `${circumference} ${circumference}`;
                progressCircle.style.strokeDashoffset = offset;
                progressCircle.style.stroke = percentage >= 100 ? '#eab308' : '#10B981'; // Gold for completion
            },
            
            updateTightnessUI() {
                // Placeholder Logic for Tightness Goal (95% adherence mockup)
                const tightnessText = document.getElementById('tightness-text');
                const tightnessProgress = document.getElementById('tightness-progress');
                
                const percentage = 95; // Mock adherence percentage
                
                tightnessText.textContent = `${percentage}%`;
                
                const radius = 15.9155;
                const circumference = 2 * Math.PI * radius;
                const offset = circumference - (percentage / 100) * circumference;
                
                tightnessProgress.style.strokeDasharray = `${circumference} ${circumference}`;
                tightnessProgress.style.strokeDashoffset = offset;
            },

            updateActivityUI() {
                 // Placeholder Logic for Activity Level (Medium - 65% mockup)
                const activityText = document.getElementById('activity-text');
                const activityProgress = document.getElementById('activity-progress');
                
                const percentage = 65; 
                
                activityText.textContent = "Med"; 
                
                const radius = 15.9155;
                const circumference = 2 * Math.PI * radius;
                const offset = circumference - (percentage / 100) * circumference;
                
                activityProgress.style.strokeDasharray = `${circumference} ${circumference}`;
                activityProgress.style.strokeDashoffset = offset;
            },
            
            updateChart() { const ctx = document.getElementById('brace-chart').getContext('2d'); const labels = []; const hoursData = []; const goalData = []; for (let i = 6; i >= 0; i--) { const d = new Date(); d.setDate(d.getDate() - i); const dateString = d.toISOString().split('T')[0]; labels.push(d.toLocaleDateString('en-US', { weekday: 'short' })); const data = this.data.braceData[dateString]; hoursData.push(data ? data.hours : 0); goalData.push(data ? data.goal : parseFloat(this.dailyGoal.value)); } if (this.braceChart) { this.braceChart.destroy(); } this.braceChart = new Chart(ctx, { type: 'bar', data: { labels: labels, datasets: [{ label: 'Hours Worn', data: hoursData, backgroundColor: 'rgba(22, 163, 74, 0.6)' }, { label: 'Goal', data: goalData, type: 'line', fill: false, borderColor: 'rgba(239, 68, 68, 1)' }] }, options: { scales: { y: { beginAtZero: true, title: { display: true, text: 'Hours' } } } } }); },
            updateRewards() { 
                const totalDaysLogged = Object.keys(this.data.braceData).length; 
                const rewards = [ 
                    { name: 'First Step', threshold: 1, icon: '', description: 'Logged your first day!' }, 
                    { name: 'Consistent Week', threshold: 7, icon: '', description: 'Logged 7 days in a row!' }, 
                    { name: '30-Day Warrior', threshold: 30, icon: '', description: 'Logged for 30 days!' },
                    { name: 'Brace Pro', threshold: 60, icon: '', description: 'Logged for 60 days!' },
                    { name: 'Century Club', threshold: 100, icon: '', description: 'Logged for 100 days!' }
                ]; 
                this.rewardsContainer.innerHTML = ''; 
                let earnedCount = 0; 
                rewards.forEach(reward => { const isEarned = totalDaysLogged >= reward.threshold; if(isEarned) earnedCount++; const rewardEl = document.createElement('div'); rewardEl.className = `text-center p-2 rounded-lg ${isEarned ? 'bg-yellow-100 dark:bg-gray-700' : 'bg-gray-100 dark:bg-gray-900'}`; rewardEl.innerHTML = `<div class="text-4xl ${isEarned ? '' : 'opacity-30'}">${reward.icon}</div><div class="font-semibold text-sm ${isEarned ? 'text-gold-600 dark:text-gold-400' : 'text-gray-500'}">${reward.name}</div><div class="text-xs text-gray-500 dark:text-gray-400">${reward.description}</div>`; this.rewardsContainer.appendChild(rewardEl); }); 
                if(earnedCount === 0){ this.rewardsContainer.innerHTML = '<p class="text-gray-500 dark:text-gray-400">Start logging to earn badges!</p>'; } 
            },
            
            // --- Physiotherapy Tracker Methods ---
            async handlePhysioSubmit(e) { e.preventDefault(); const date = this.physioDate.value; const minutes = parseFloat(this.physioMinutes.value); const goal = parseFloat(this.physioDailyGoal.value); if (!date || isNaN(minutes) || isNaN(goal)) { return; } this.data.physioData[date] = { minutes, goal }; await this.logActivity(); await this.saveDataToDrive(); this.updatePhysioProgressUI(date); this.updatePhysioChart(); this.updatePhysioRewards(); this.physioForm.reset(); this.physioDate.valueAsDate = new Date(); },
            loadPhysioData() { const today = new Date().toISOString().split('T')[0]; this.updatePhysioProgressUI(today); this.updatePhysioChart(); this.updatePhysioRewards(); },
            updatePhysioProgressUI(date) { const data = this.data.physioData[date]; if (data) { const percentage = Math.min(100, Math.round((data.minutes / data.goal) * 100)); this.physioProgressBar.style.width = `${percentage}%`; this.physioProgressBar.textContent = `${percentage}%`; this.physioProgressText.textContent = `You've logged ${data.minutes} of ${data.goal} minutes today. Great job!`; } else { this.physioProgressBar.style.width = '0%'; this.physioProgressBar.textContent = '0%'; this.physioProgressText.textContent = 'Log your session to see your progress!'; } },
            updatePhysioChart() { const ctx = document.getElementById('physio-chart').getContext('2d'); const labels = []; const minutesData = []; const goalData = []; for (let i = 6; i >= 0; i--) { const d = new Date(); d.setDate(d.getDate() - i); const dateString = d.toISOString().split('T')[0]; labels.push(d.toLocaleDateString('en-US', { weekday: 'short' })); const data = this.data.physioData[dateString]; minutesData.push(data ? data.minutes : 0); goalData.push(data ? data.goal : parseFloat(this.physioDailyGoal.value)); } if (this.physioChart) { this.physioChart.destroy(); } this.physioChart = new Chart(ctx, { type: 'bar', data: { labels: labels, datasets: [{ label: 'Minutes of PT', data: minutesData, backgroundColor: 'rgba(22, 163, 74, 0.6)' }, { label: 'Goal', data: goalData, type: 'line', fill: false, borderColor: 'rgba(239, 68, 68, 1)' }] }, options: { scales: { y: { beginAtZero: true, title: { display: true, text: 'Minutes' } } } } }); },
            updatePhysioRewards() { 
                const totalDaysLogged = Object.keys(this.data.physioData).length; 
                const rewards = [ 
                    { name: 'First Session', threshold: 1, icon: '', description: 'Logged your first PT session!' }, 
                    { name: 'PT Week', threshold: 7, icon: '', description: 'Logged PT 7 days in a row!' }, 
                    { name: 'Month of Motion', threshold: 30, icon: '', description: 'Logged PT for 30 days!' },
                    { name: 'PT Expert', threshold: 60, icon: '', description: 'Logged 60 PT sessions!' },
                    { name: 'Movement Master', threshold: 100, icon: '', description: 'Logged 100 PT sessions!' }
                ]; 
                this.physioRewardsContainer.innerHTML = ''; 
                let earnedCount = 0; 
                rewards.forEach(reward => { const isEarned = totalDaysLogged >= reward.threshold; if(isEarned) earnedCount++; const rewardEl = document.createElement('div'); rewardEl.className = `text-center p-2 rounded-lg ${isEarned ? 'bg-yellow-100 dark:bg-gray-700' : 'bg-gray-100 dark:bg-gray-900'}`; rewardEl.innerHTML = `<div class="text-4xl ${isEarned ? '' : 'opacity-30'}">${reward.icon}</div><div class="font-semibold text-sm ${isEarned ? 'text-gold-600 dark:text-gold-400' : 'text-gray-500'}">${reward.name}</div><div class="text-xs text-gray-500 dark:text-gray-400">${reward.description}</div>`; this.physioRewardsContainer.appendChild(rewardEl); }); 
                if(earnedCount === 0){ this.physioRewardsContainer.innerHTML = '<p class="text-gray-500 dark:text-gray-400">Start logging to earn badges!</p>'; } 
            },
            
            // --- Growth Tracker Methods ---
            async handleGrowthSubmit(e) { e.preventDefault(); const date = this.growthDate.value; const height = parseFloat(this.growthHeight.value); const weight = parseFloat(this.growthWeight.value); if (!date || (isNaN(height) && isNaN(weight))) { return; } this.data.growthData[date] = { height: isNaN(height) ? null : height, weight: isNaN(weight) ? null : weight }; await this.saveDataToDrive(); this.updateGrowthChart(); this.growthForm.reset(); this.growthDate.valueAsDate = new Date(); },
            loadGrowthData() { this.updateGrowthChart(); },
            updateGrowthChart() { const ctx = document.getElementById('growth-chart').getContext('2d'); const sortedDates = Object.keys(this.data.growthData).sort((a, b) => new Date(a) - new Date(b)); const labels = sortedDates.map(date => new Date(date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })); const heightData = sortedDates.map(date => this.data.growthData[date].height); const weightData = sortedDates.map(date => this.data.growthData[date].weight); if (this.growthChart) { this.growthChart.destroy(); } this.growthChart = new Chart(ctx, { type: 'line', data: { labels: labels, datasets: [ { label: 'Height (cm)', data: heightData, borderColor: 'rgba(22, 163, 74, 1)', backgroundColor: 'rgba(22, 163, 74, 0.1)', fill: true, yAxisID: 'yHeight', spanGaps: true, }, { label: 'Weight (kg)', data: weightData, borderColor: 'rgba(234, 179, 8, 1)', backgroundColor: 'rgba(234, 179, 8, 0.1)', fill: true, yAxisID: 'yWeight', spanGaps: true, } ] }, options: { scales: { yHeight: { type: 'linear', display: true, position: 'left', title: { display: true, text: 'Height (cm)' } }, yWeight: { type: 'linear', display: true, position: 'right', title: { display: true, text: 'Weight (kg)' }, grid: { drawOnChartArea: false, } } } } }); },


            // --- Journal Methods ---
            async handleJournalSubmit(e) { e.preventDefault(); const text = this.journalEntry.value.trim(); if (text === '') return; const newEntry = { id: Date.now(), date: new Date().toISOString(), text: text }; this.data.journalData.unshift(newEntry); await this.saveDataToDrive(); this.renderJournalEntries(); this.journalForm.reset(); },
            loadJournalData() { this.renderJournalEntries(); },
            renderJournalEntries() {
                this.journalEntriesContainer.innerHTML = '';
                if(this.data.journalData.length === 0) {
                    this.journalEntriesContainer.innerHTML = '<p class="text-gray-500 dark:text-gray-400">Your saved entries will appear here.</p>';
                    return;
                }
                this.data.journalData.forEach(entry => {
                    const entryEl = document.createElement('div');
                    entryEl.className = 'bg-white dark:bg-gray-800 p-4 rounded-lg shadow border border-gray-200 dark:border-gray-700';
                    const entryDate = new Date(entry.date);
                    entryEl.innerHTML = `
                        <div class="flex justify-between items-center mb-2">
                            <p class="font-semibold text-gray-700 dark:text-gray-300">${entryDate.toLocaleDateString()} - ${entryDate.toLocaleTimeString()}</p>
                            <button data-id="${entry.id}" class="delete-entry-btn text-red-500 hover:text-red-700 font-bold text-xl px-2">&times;</button>
                        </div>
                        <p class="text-gray-800 dark:text-gray-200 whitespace-pre-wrap">${entry.text}</p>
                    `;
                    this.journalEntriesContainer.appendChild(entryEl);
                });

                document.querySelectorAll('.delete-entry-btn').forEach(btn => btn.addEventListener('click', (e) => this.deleteJournalEntry(e)));
            },
            async deleteJournalEntry(e) { const entryId = parseInt(e.target.dataset.id, 10); this.data.journalData = this.data.journalData.filter(entry => entry.id !== entryId); await this.saveDataToDrive(); this.renderJournalEntries(); },
        };

        function gisLoaded() {
            app.googleGisReady = true;
            app.init();
        }
    </script>
</body>
</html>
